<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <title>Screener ‚Äî Timed Trading</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="auth-gate.js"></script>
    <style>
      :root {
        --tt-bg-base: #0b0e11;
        --tt-bg-surface: rgba(255,255,255,0.02);
        --tt-bg-elevated: rgba(255,255,255,0.035);
        --tt-bg-hover: rgba(255,255,255,0.04);
        --tt-border: rgba(255,255,255,0.04);
        --tt-border-strong: rgba(255,255,255,0.08);
        --tt-text: #e5e7eb;
        --tt-text-muted: #6b7280;
        --tt-text-faint: #4b5563;
        --tt-accent: #00c853;
        --tt-accent-dim: rgba(0, 200, 83, 0.12);
        --tt-negative: #ff5252;
        --tt-negative-dim: rgba(255, 82, 82, 0.12);
        --tt-radius: 12px;
        --tt-radius-sm: 8px;
        --tt-font: "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      }
      body {
        background: var(--tt-bg-base);
        color: var(--tt-text);
        font-family: var(--tt-font);
        -webkit-font-smoothing: antialiased;
        margin: 0;
      }
      .tt-card {
        background: var(--tt-bg-surface);
        border: 1px solid var(--tt-border);
        border-radius: var(--tt-radius);
      }
      .loading-spinner {
        border: 2px solid var(--tt-border);
        border-top-color: var(--tt-accent);
        border-radius: 50%;
        width: 20px;
        height: 20px;
        animation: spin 0.8s linear infinite;
      }
      @keyframes spin { to { transform: rotate(360deg); } }
      ::-webkit-scrollbar { width: 6px; height: 6px; }
      ::-webkit-scrollbar-track { background: transparent; }
      ::-webkit-scrollbar-thumb { background: #374151; border-radius: 3px; }
    </style>
  </head>
  <body>
    <div id="root"></div>
    <script type="text/babel">
      const { useState, useEffect, useMemo, useCallback, useRef } = React;

      const API_BASE = "";  // same-origin ‚Äî proxied by Pages Function

      // ‚îÄ‚îÄ Helpers ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      const fmtNum = (n, decimals = 1) => {
        if (n == null || !Number.isFinite(Number(n))) return "‚Äî";
        return Number(n).toLocaleString("en-US", { maximumFractionDigits: decimals });
      };
      const fmtMcap = (n) => {
        if (!Number.isFinite(Number(n)) || Number(n) === 0) return "‚Äî";
        const b = Number(n) / 1e9;
        return b >= 1 ? `$${b.toFixed(1)}B` : `$${(Number(n) / 1e6).toFixed(0)}M`;
      };
      const fmtVol = (n) => {
        if (!Number.isFinite(Number(n)) || Number(n) === 0) return "‚Äî";
        const v = Number(n);
        if (v >= 1e6) return `${(v / 1e6).toFixed(1)}M`;
        if (v >= 1e3) return `${(v / 1e3).toFixed(0)}K`;
        return String(v);
      };
      const fmtPct = (n) => {
        if (n == null || !Number.isFinite(Number(n))) return "‚Äî";
        const v = Number(n);
        return `${v >= 0 ? "+" : ""}${v.toFixed(1)}%`;
      };

      // ‚îÄ‚îÄ Scan Type Definitions ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      const SCAN_TYPES = [
        { id: "all", label: "All", icon: "‚äõ" },
        { id: "daily_momentum", label: "Daily Momentum", icon: "‚ö°" },
        { id: "top_gainer", label: "Top Gainers", icon: "‚Üë" },
        { id: "top_loser", label: "Top Losers", icon: "‚Üì" },
        { id: "weekly_momentum", label: "Weekly", icon: "üìà" },
      ];

      const SORT_OPTIONS = [
        { id: "change_desc", label: "Change % ‚Üì", fn: (a, b) => Math.abs(b.change_pct || 0) - Math.abs(a.change_pct || 0) },
        { id: "change_asc", label: "Change % ‚Üë", fn: (a, b) => Math.abs(a.change_pct || 0) - Math.abs(b.change_pct || 0) },
        { id: "mcap_desc", label: "Market Cap ‚Üì", fn: (a, b) => (b.market_cap || 0) - (a.market_cap || 0) },
        { id: "volume_desc", label: "Volume ‚Üì", fn: (a, b) => (b.volume || 0) - (a.volume || 0) },
        { id: "ticker_asc", label: "Ticker A-Z", fn: (a, b) => (a.ticker || "").localeCompare(b.ticker || "") },
        { id: "recent", label: "Most Recent", fn: (a, b) => new Date(b.discovered_at || 0) - new Date(a.discovered_at || 0) },
      ];

      // ‚îÄ‚îÄ Main App Component ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      function App({ user }) {
        const [candidates, setCandidates] = useState([]);
        const [loading, setLoading] = useState(true);
        const [error, setError] = useState(null);
        const [scanTs, setScanTs] = useState(null);
        const [scanFilter, setScanFilter] = useState("all");
        const [sortBy, setSortBy] = useState("change_desc");
        const [search, setSearch] = useState("");
        const [sectorFilter, setSectorFilter] = useState("all");
        const [addingTickers, setAddingTickers] = useState(new Set());
        const [addedTickers, setAddedTickers] = useState(new Set());
        const [existingTickers, setExistingTickers] = useState(new Set());
        const [selectedTickers, setSelectedTickers] = useState(new Set());

        // Fetch candidates
        const fetchCandidates = useCallback(async () => {
          setLoading(true);
          setError(null);
          try {
            const res = await fetch(`${API_BASE}/timed/screener/candidates`, { cache: "no-store" });
            if (!res.ok) throw new Error(`HTTP ${res.status}`);
            const json = await res.json();
            if (!json.ok) throw new Error(json.error || "Unknown error");
            setCandidates(json.candidates || []);
            setScanTs(json.scan_ts || json.last_updated || null);
          } catch (e) {
            setError(e.message);
          } finally {
            setLoading(false);
          }
        }, []);

        // Fetch existing tickers in our universe
        const fetchExistingTickers = useCallback(async () => {
          try {
            const res = await fetch(`${API_BASE}/timed/tickers`, { cache: "no-store" });
            if (res.ok) {
              const json = await res.json();
              const tickers = json.tickers || json.data || [];
              setExistingTickers(new Set(tickers.map(t => String(t).toUpperCase())));
            }
          } catch { /* ignore */ }
        }, []);

        useEffect(() => {
          fetchCandidates();
          fetchExistingTickers();
        }, [fetchCandidates, fetchExistingTickers]);

        // Derived: sectors for filter
        const sectors = useMemo(() => {
          const s = new Set();
          for (const c of candidates) {
            if (c.sector) s.add(c.sector);
          }
          return ["all", ...Array.from(s).sort()];
        }, [candidates]);

        // Derived: scan types present
        const scanTypeCounts = useMemo(() => {
          const counts = { all: candidates.length };
          for (const c of candidates) {
            const st = c.scan_type || "other";
            counts[st] = (counts[st] || 0) + 1;
          }
          return counts;
        }, [candidates]);

        // Filtered + sorted candidates
        const filteredCandidates = useMemo(() => {
          let result = [...candidates];

          // Scan type filter
          if (scanFilter !== "all") {
            result = result.filter(c => c.scan_type === scanFilter);
          }

          // Sector filter
          if (sectorFilter !== "all") {
            result = result.filter(c => c.sector === sectorFilter);
          }

          // Search
          if (search.trim()) {
            const q = search.trim().toLowerCase();
            result = result.filter(c =>
              (c.ticker || "").toLowerCase().includes(q) ||
              (c.name || "").toLowerCase().includes(q) ||
              (c.sector || "").toLowerCase().includes(q)
            );
          }

          // Sort
          const sortOpt = SORT_OPTIONS.find(s => s.id === sortBy);
          if (sortOpt) result.sort(sortOpt.fn);

          return result;
        }, [candidates, scanFilter, sectorFilter, search, sortBy]);

        // Add to universe
        const addToUniverse = useCallback(async (tickers) => {
          if (!tickers.length) return;
          const tickerSet = new Set(tickers.map(t => t.toUpperCase()));
          setAddingTickers(prev => new Set([...prev, ...tickerSet]));
          try {
            const res = await fetch(`${API_BASE}/timed/watchlist/add`, {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              credentials: "include",
              body: JSON.stringify({ tickers: tickers.map(t => t.toUpperCase()) }),
            });
            if (res.ok) {
              setAddedTickers(prev => new Set([...prev, ...tickerSet]));
              setExistingTickers(prev => new Set([...prev, ...tickerSet]));
              setSelectedTickers(new Set());
            } else {
              const json = await res.json().catch(() => ({}));
              console.error("Add failed:", json.error || res.statusText);
            }
          } catch (e) {
            console.error("Add failed:", e);
          } finally {
            setAddingTickers(prev => {
              const next = new Set(prev);
              for (const t of tickerSet) next.delete(t);
              return next;
            });
          }
        }, []);

        // Toggle ticker selection
        const toggleSelect = useCallback((ticker) => {
          setSelectedTickers(prev => {
            const next = new Set(prev);
            if (next.has(ticker)) next.delete(ticker);
            else next.add(ticker);
            return next;
          });
        }, []);

        const UserBadge = window.TimedUserBadge;
        const storedUser = window.TimedAuthHelpers?.getStoredSession();

        return (
          <div className="min-h-screen">
            {/* ‚ïê‚ïê‚ïê Nav Bar ‚ïê‚ïê‚ïê */}
            <nav className="flex items-center justify-between px-4 py-2.5 mb-4 border-b border-white/[0.04]">
              <div className="flex items-center gap-5">
                <span className="text-[15px] font-semibold text-white tracking-tight">Timed Trading</span>
                <div className="flex items-center gap-0.5">
                  <a href="index-react.html" className="px-3 py-1 rounded-md text-[13px] text-[#6b7280] hover:text-white hover:bg-white/[0.04] transition-all">Dashboard</a>
                  <a href="simulation-dashboard.html" className="px-3 py-1 rounded-md text-[13px] text-[#6b7280] hover:text-white hover:bg-white/[0.04] transition-all">Trades</a>
                  <a href="model-dashboard.html" className="px-3 py-1 rounded-md text-[13px] text-[#6b7280] hover:text-white hover:bg-white/[0.04] transition-all">Model</a>
                  <a href="screener.html" className="px-3 py-1 rounded-md text-[13px] text-white bg-white/[0.07] font-medium">Screener</a>
                  <a href="ticker-management.html" className="px-3 py-1 rounded-md text-[13px] text-[#6b7280] hover:text-white hover:bg-white/[0.04] transition-all">Tickers</a>
                </div>
              </div>
              <div className="flex items-center gap-3">
                {scanTs && (
                  <span className="text-[11px] text-[#4b5563]">
                    Last scan: {new Date(scanTs).toLocaleString()}
                  </span>
                )}
                {UserBadge && <UserBadge user={storedUser} compact />}
              </div>
            </nav>

            <div className="max-w-[1400px] mx-auto px-4">
              {/* Header */}
              <div className="flex items-center justify-between mb-6">
                <div>
                  <h1 className="text-lg font-semibold tracking-tight text-white">Screener</h1>
                  <p className="text-[13px] text-[#6b7280] mt-0.5">
                    Discover new tickers not yet in our universe
                  </p>
                </div>
                <div className="flex items-center gap-2">
                  {selectedTickers.size > 0 && (
                    <button
                      onClick={() => addToUniverse(Array.from(selectedTickers))}
                      className="px-4 py-1.5 rounded-lg text-[13px] font-medium bg-[#00c853]/15 text-[#00c853] border border-[#00c853]/30 hover:bg-[#00c853]/25 transition-all"
                    >
                      Add {selectedTickers.size} to Universe
                    </button>
                  )}
                  <button
                    onClick={fetchCandidates}
                    disabled={loading}
                    className="px-3 py-1.5 rounded-lg text-[12px] text-[#9ca3af] border border-white/[0.06] hover:bg-white/[0.04] transition-all disabled:opacity-50"
                  >
                    {loading ? "Loading..." : "Refresh"}
                  </button>
                </div>
              </div>

              {/* Filters Row */}
              <div className="flex items-center gap-4 flex-wrap mb-4">
                {/* Scan Type Toggles */}
                <div className="flex items-center gap-1 bg-white/[0.02] rounded-lg p-1 border border-white/[0.04]">
                  {SCAN_TYPES.map(st => {
                    const count = scanTypeCounts[st.id] || 0;
                    const active = scanFilter === st.id;
                    return (
                      <button
                        key={st.id}
                        onClick={() => setScanFilter(st.id)}
                        className={`px-3 py-1.5 rounded-md text-[12px] transition-all flex items-center gap-1.5 ${
                          active
                            ? "bg-white/[0.08] text-white font-medium"
                            : "text-[#6b7280] hover:text-white hover:bg-white/[0.04]"
                        }`}
                      >
                        <span>{st.icon}</span>
                        <span>{st.label}</span>
                        {count > 0 && (
                          <span className={`text-[10px] px-1.5 py-0.5 rounded-full ${
                            active ? "bg-white/[0.1] text-white" : "bg-white/[0.04] text-[#4b5563]"
                          }`}>
                            {count}
                          </span>
                        )}
                      </button>
                    );
                  })}
                </div>

                {/* Sector Filter */}
                <select
                  value={sectorFilter}
                  onChange={e => setSectorFilter(e.target.value)}
                  className="bg-white/[0.03] border border-white/[0.06] rounded-lg px-3 py-1.5 text-[12px] text-[#9ca3af] focus:outline-none focus:border-white/[0.12] appearance-none cursor-pointer"
                  style={{ minWidth: "140px" }}
                >
                  {sectors.map(s => (
                    <option key={s} value={s} style={{ background: "#1a1d23", color: "#e5e7eb" }}>
                      {s === "all" ? "All Sectors" : s}
                    </option>
                  ))}
                </select>

                {/* Sort */}
                <select
                  value={sortBy}
                  onChange={e => setSortBy(e.target.value)}
                  className="bg-white/[0.03] border border-white/[0.06] rounded-lg px-3 py-1.5 text-[12px] text-[#9ca3af] focus:outline-none focus:border-white/[0.12] appearance-none cursor-pointer"
                  style={{ minWidth: "130px" }}
                >
                  {SORT_OPTIONS.map(s => (
                    <option key={s.id} value={s.id} style={{ background: "#1a1d23", color: "#e5e7eb" }}>
                      {s.label}
                    </option>
                  ))}
                </select>

                {/* Search */}
                <div className="relative flex-1 max-w-[260px]">
                  <input
                    type="text"
                    value={search}
                    onChange={e => setSearch(e.target.value)}
                    placeholder="Search ticker or name..."
                    className="w-full bg-white/[0.03] border border-white/[0.06] rounded-lg px-3 py-1.5 text-[12px] text-white placeholder:text-[#4b5563] focus:outline-none focus:border-white/[0.12]"
                  />
                  {search && (
                    <button
                      onClick={() => setSearch("")}
                      className="absolute right-2 top-1/2 -translate-y-1/2 text-[#4b5563] hover:text-white text-sm"
                    >
                      √ó
                    </button>
                  )}
                </div>

                {/* Count */}
                <span className="text-[11px] text-[#4b5563] ml-auto">
                  {filteredCandidates.length} result{filteredCandidates.length !== 1 ? "s" : ""}
                </span>
              </div>

              {/* Error */}
              {error && (
                <div className="tt-card p-4 mb-4 border border-red-500/20">
                  <span className="text-[13px] text-red-400">{error}</span>
                </div>
              )}

              {/* Loading */}
              {loading && candidates.length === 0 && (
                <div className="flex items-center justify-center py-20">
                  <div className="loading-spinner" style={{ width: "32px", height: "32px" }} />
                </div>
              )}

              {/* Results Table */}
              {!loading && filteredCandidates.length === 0 && (
                <div className="tt-card p-12 text-center">
                  <p className="text-[#6b7280] text-sm mb-2">No candidates found</p>
                  <p className="text-[#4b5563] text-xs">
                    Run the discovery script to populate: <code className="bg-white/[0.04] px-1.5 py-0.5 rounded text-[#9ca3af]">python scripts/discover-tickers.py --post --api-key YOUR_KEY</code>
                  </p>
                </div>
              )}

              {filteredCandidates.length > 0 && (
                <div className="tt-card overflow-hidden">
                  {/* Table Header */}
                  <div className="grid items-center gap-3 px-4 py-2.5 border-b border-white/[0.06] text-[10px] font-medium text-[#4b5563] uppercase tracking-wider"
                    style={{ gridTemplateColumns: "32px 80px 1fr 80px 80px 90px 70px 80px 100px 120px" }}>
                    <div className="flex items-center">
                      <input
                        type="checkbox"
                        checked={selectedTickers.size > 0 && selectedTickers.size === filteredCandidates.filter(c => !existingTickers.has(c.ticker?.toUpperCase())).length}
                        onChange={(e) => {
                          if (e.target.checked) {
                            const newTickers = filteredCandidates
                              .filter(c => !existingTickers.has(c.ticker?.toUpperCase()))
                              .map(c => c.ticker?.toUpperCase());
                            setSelectedTickers(new Set(newTickers));
                          } else {
                            setSelectedTickers(new Set());
                          }
                        }}
                        className="w-3.5 h-3.5 rounded accent-[#00c853] cursor-pointer"
                      />
                    </div>
                    <div>Ticker</div>
                    <div>Name</div>
                    <div className="text-right">Price</div>
                    <div className="text-right">Change</div>
                    <div className="text-right">Volume</div>
                    <div className="text-right">RSI</div>
                    <div className="text-right">MCap</div>
                    <div>Sector</div>
                    <div className="text-center">Action</div>
                  </div>

                  {/* Table Body */}
                  <div className="divide-y divide-white/[0.03]">
                    {filteredCandidates.map((c, idx) => {
                      const ticker = (c.ticker || "").toUpperCase();
                      const inUniverse = existingTickers.has(ticker);
                      const justAdded = addedTickers.has(ticker);
                      const isAdding = addingTickers.has(ticker);
                      const isSelected = selectedTickers.has(ticker);
                      const changePct = c.change_pct ?? c.week_change_pct;
                      const isPositive = Number(changePct) >= 0;

                      return (
                        <div
                          key={`${ticker}-${idx}`}
                          className={`grid items-center gap-3 px-4 py-2.5 text-[13px] transition-all hover:bg-white/[0.02] ${isSelected ? "bg-[#00c853]/[0.04]" : ""}`}
                          style={{ gridTemplateColumns: "32px 80px 1fr 80px 80px 90px 70px 80px 100px 120px" }}
                        >
                          {/* Checkbox */}
                          <div>
                            {!inUniverse && (
                              <input
                                type="checkbox"
                                checked={isSelected}
                                onChange={() => toggleSelect(ticker)}
                                className="w-3.5 h-3.5 rounded accent-[#00c853] cursor-pointer"
                              />
                            )}
                          </div>

                          {/* Ticker */}
                          <div className="flex items-center gap-1.5">
                            <span className="font-semibold text-white">{ticker}</span>
                            {c.scan_type && (
                              <span className={`text-[8px] px-1 py-0.5 rounded font-medium ${
                                c.scan_type === "top_gainer" ? "bg-green-500/15 text-green-400" :
                                c.scan_type === "top_loser" ? "bg-red-500/15 text-red-400" :
                                c.scan_type === "weekly_momentum" ? "bg-purple-500/15 text-purple-400" :
                                "bg-blue-500/15 text-blue-400"
                              }`}>
                                {c.scan_type === "daily_momentum" ? "MOM" :
                                 c.scan_type === "top_gainer" ? "GAIN" :
                                 c.scan_type === "top_loser" ? "LOSS" :
                                 c.scan_type === "weekly_momentum" ? "WEEK" : c.scan_type.substring(0, 4).toUpperCase()}
                              </span>
                            )}
                          </div>

                          {/* Name */}
                          <div className="text-[#9ca3af] truncate text-[12px]">{c.name || ticker}</div>

                          {/* Price */}
                          <div className="text-right tabular-nums text-white">
                            {c.price ? `$${Number(c.price).toFixed(2)}` : "‚Äî"}
                          </div>

                          {/* Change */}
                          <div className={`text-right tabular-nums font-medium ${
                            Number(changePct) > 0 ? "text-[#00c853]" : Number(changePct) < 0 ? "text-[#ff5252]" : "text-[#6b7280]"
                          }`}>
                            {changePct != null ? fmtPct(changePct) : "‚Äî"}
                          </div>

                          {/* Volume */}
                          <div className="text-right tabular-nums text-[#9ca3af]">{fmtVol(c.volume)}</div>

                          {/* RSI */}
                          <div className={`text-right tabular-nums ${
                            c.rsi > 70 ? "text-red-400" : c.rsi < 30 ? "text-green-400" : "text-[#9ca3af]"
                          }`}>
                            {c.rsi ? c.rsi.toFixed(0) : "‚Äî"}
                          </div>

                          {/* Market Cap */}
                          <div className="text-right tabular-nums text-[#9ca3af]">{fmtMcap(c.market_cap)}</div>

                          {/* Sector */}
                          <div className="text-[11px] text-[#6b7280] truncate">{c.sector || "‚Äî"}</div>

                          {/* Action */}
                          <div className="flex justify-center">
                            {inUniverse && !justAdded ? (
                              <span className="text-[11px] px-2 py-1 rounded-md bg-white/[0.04] text-[#6b7280]">
                                In Universe
                              </span>
                            ) : justAdded ? (
                              <span className="text-[11px] px-2 py-1 rounded-md bg-[#00c853]/15 text-[#00c853] font-medium">
                                Added ‚úì
                              </span>
                            ) : isAdding ? (
                              <span className="text-[11px] px-2 py-1 rounded-md bg-white/[0.04] text-[#6b7280]">
                                Adding...
                              </span>
                            ) : (
                              <button
                                onClick={() => addToUniverse([ticker])}
                                className="text-[11px] px-2.5 py-1 rounded-md bg-[#00c853]/10 text-[#00c853] border border-[#00c853]/20 hover:bg-[#00c853]/20 transition-all font-medium"
                              >
                                + Add
                              </button>
                            )}
                          </div>
                        </div>
                      );
                    })}
                  </div>
                </div>
              )}

              {/* Summary Stats */}
              {candidates.length > 0 && (
                <div className="flex items-center gap-6 mt-4 mb-8 px-1">
                  <div className="text-[11px] text-[#4b5563]">
                    Total candidates: <span className="text-[#9ca3af]">{candidates.length}</span>
                  </div>
                  <div className="text-[11px] text-[#4b5563]">
                    Already tracked: <span className="text-[#9ca3af]">{candidates.filter(c => existingTickers.has((c.ticker || "").toUpperCase())).length}</span>
                  </div>
                  <div className="text-[11px] text-[#4b5563]">
                    New discoveries: <span className="text-[#00c853]">{candidates.filter(c => !existingTickers.has((c.ticker || "").toUpperCase())).length}</span>
                  </div>
                </div>
              )}
            </div>
          </div>
        );
      }

      // ‚îÄ‚îÄ Mount ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      const AuthGate = window.TimedAuthGate;
      const screenerApp = AuthGate
        ? <AuthGate apiBase={API_BASE} requiredTier="admin">{(user) => <App user={user} />}</AuthGate>
        : <App />;
      ReactDOM.createRoot(document.getElementById("root")).render(screenerApp);
    </script>
  </body>
</html>

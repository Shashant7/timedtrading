<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Signing Out — Timed Trading</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      background: radial-gradient(ellipse at 50% 0%, #111820 0%, #0b0e11 60%);
      font-family: "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      color: #e5e7eb;
    }
    .card {
      text-align: center;
      max-width: 360px;
      padding: 32px 24px;
      animation: fadeIn 0.4s ease-out;
    }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: translateY(0); } }
    @keyframes spin { to { transform: rotate(360deg); } }
    .spinner {
      width: 32px; height: 32px;
      border: 2px solid rgba(255,255,255,0.06);
      border-top-color: #00c853;
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
      margin: 0 auto 16px;
    }
    h1 { font-size: 16px; font-weight: 600; margin-bottom: 8px; }
    p { font-size: 13px; color: #6b7280; line-height: 1.5; }
    .success { display: none; }
    .success .check {
      width: 32px; height: 32px; margin: 0 auto 16px;
      border-radius: 50%;
      background: rgba(0,200,83,0.1);
      display: flex; align-items: center; justify-content: center;
    }
    .success .check svg { width: 18px; height: 18px; color: #00c853; }
    .links { margin-top: 20px; display: flex; flex-direction: column; gap: 8px; }
    .links a {
      display: block; padding: 12px 20px; border-radius: 10px;
      text-decoration: none; font-size: 14px; font-weight: 500;
      transition: all 0.2s;
    }
    .links .primary {
      background: rgba(0,200,83,0.1); color: #00c853;
      border: 1px solid rgba(0,200,83,0.2);
    }
    .links .primary:hover { background: rgba(0,200,83,0.15); }
    .links .secondary {
      background: transparent; color: #9ca3af;
      border: 1px solid rgba(255,255,255,0.06);
    }
    .links .secondary:hover { background: rgba(255,255,255,0.03); color: #e5e7eb; }
  </style>
</head>
<body>
  <!-- Phase 1: Signing out spinner -->
  <div class="card" id="signing-out">
    <div class="spinner"></div>
    <h1>Signing you out...</h1>
    <p>Clearing your session securely.</p>
  </div>

  <!-- Phase 2: Signed out confirmation -->
  <div class="card success" id="signed-out">
    <div class="check">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
        <polyline points="20 6 9 17 4 12" />
      </svg>
    </div>
    <h1>You've been signed out</h1>
    <p>Your session has been cleared.</p>
    <div class="links">
      <a href="/index-react.html" class="primary">Sign In Again</a>
      <a href="/splash.html" class="secondary">Back to Home</a>
    </div>
  </div>

  <!-- Hidden iframe to hit CF Access logout endpoint -->
  <iframe id="cf-logout" src="about:blank" style="display:none"></iframe>

  <script>
    (function() {
      // 1. Clear app session from localStorage
      try { localStorage.removeItem("timed_auth_session"); } catch(_) {}

      // 2. Attempt client-side cookie deletion
      try {
        var d = window.location.hostname;
        document.cookie = "CF_Authorization=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";
        document.cookie = "CF_Authorization=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/; domain=" + d;
        document.cookie = "CF_Authorization=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/; domain=." + d;
      } catch(_) {}

      // 3. Hit CF Access logout endpoint in hidden iframe and wait for it
      var iframe = document.getElementById("cf-logout");
      var done = false;

      function showSuccess() {
        if (done) return;
        done = true;
        document.getElementById("signing-out").style.display = "none";
        document.getElementById("signed-out").style.display = "block";
      }

      iframe.onload = function() {
        // iframe loaded the logout page — session cleared server-side
        // Small delay to ensure cookies propagate
        setTimeout(showSuccess, 500);
      };

      iframe.onerror = function() {
        // Even on error, we've cleared client-side — proceed
        setTimeout(showSuccess, 300);
      };

      // Start the logout
      iframe.src = window.location.origin + "/cdn-cgi/access/logout";

      // Safety timeout: if iframe doesn't respond in 4 seconds, show success anyway
      // (client-side cookies are already cleared)
      setTimeout(showSuccess, 4000);

      // Also set a sessionStorage flag so LoginScreen can show "signed out" message
      try { sessionStorage.setItem("tt_logout", "1"); } catch(_) {}
    })();
  </script>
</body>
</html>

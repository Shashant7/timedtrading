<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes" />
    <title>Timed Trading â€” Investor</title>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cdefs%3E%3ClinearGradient id='g' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' stop-color='%2300c853'/%3E%3Cstop offset='50%25' stop-color='%2300e676'/%3E%3Cstop offset='100%25' stop-color='%2369f0ae'/%3E%3C/linearGradient%3E%3C/defs%3E%3Crect width='24' height='24' rx='5.5' fill='url(%23g)'/%3E%3Cpolyline points='22 7 13.5 15.5 8.5 10.5 2 17' fill='none' stroke='white' stroke-width='2.5' stroke-linecap='round' stroke-linejoin='round'/%3E%3Cpolyline points='16 7 22 7 22 13' fill='none' stroke='white' stroke-width='2.5' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script crossorigin src="https://unpkg.com/prop-types@15/prop-types.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="auth-gate.js?v=20260219a"></script>
    <script src="shared-price-utils.js?v=20260225a"></script>
    <style>
      * { box-sizing: border-box; }
      body { margin: 0; background: #0a0a0f; color: #e5e7eb; font-family: 'Inter', system-ui, sans-serif; }
      .loading-spinner { width: 24px; height: 24px; position: relative; display: inline-block; }
      .loading-spinner::before { content: ""; position: absolute; inset: 0; border-radius: 5px; background: linear-gradient(135deg, rgba(0,200,83,0.15), rgba(0,200,83,0.04)); animation: tt-loader-pulse 1.6s ease-in-out infinite; }
      .loading-spinner::after { content: ""; position: absolute; left: 2px; right: 2px; top: 50%; height: 1.5px; background: linear-gradient(90deg, transparent, #00c853, #00e676, #69f0ae, transparent); background-size: 200% 100%; border-radius: 1px; animation: tt-loader-sweep 1.2s ease-in-out infinite; }
      @keyframes tt-loader-pulse { 0%, 100% { opacity: 0.4; transform: scale(0.92); } 50% { opacity: 1; transform: scale(1); } }
      @keyframes tt-loader-sweep { 0% { background-position: -100% 0; opacity: 0.5; } 50% { opacity: 1; } 100% { background-position: 200% 0; opacity: 0.5; } }
      @keyframes spin { to { transform: rotate(360deg); } }
      @keyframes pulse-badge {
        0%, 100% { opacity: 1; transform: scale(1); }
        50% { opacity: 0.7; transform: scale(1.15); }
      }
      @keyframes fadeIn { from { opacity: 0; transform: translateY(4px); } to { opacity: 1; transform: translateY(0); } }
      .fade-in { animation: fadeIn 0.3s ease-out; }
      .card { background: rgba(255,255,255,0.02); border: 1px solid rgba(255,255,255,0.06); border-radius: 12px; }
      .card-hover:hover { background: rgba(255,255,255,0.04); border-color: rgba(255,255,255,0.1); }
      .stage-badge { padding: 2px 8px; border-radius: 6px; font-size: 11px; font-weight: 600; text-transform: uppercase; }
      .stage-accumulate { background: rgba(16,185,129,0.15); color: #34d399; border: 1px solid rgba(16,185,129,0.3); }
      .stage-core_hold { background: rgba(59,130,246,0.15); color: #60a5fa; border: 1px solid rgba(59,130,246,0.3); }
      .stage-watch { background: rgba(245,158,11,0.15); color: #fbbf24; border: 1px solid rgba(245,158,11,0.3); }
      .stage-reduce { background: rgba(239,68,68,0.15); color: #f87171; border: 1px solid rgba(239,68,68,0.3); }
      .stage-research { background: rgba(139,92,246,0.15); color: #a78bfa; border: 1px solid rgba(139,92,246,0.3); }
      .stage-exited { background: rgba(107,114,128,0.15); color: #9ca3af; border: 1px solid rgba(107,114,128,0.3); }
      /* Admin-only nav links: hidden for non-admin users */
      body:not([data-user-role="admin"]) a[data-admin-only] {
        display: none !important;
      }
      /* Scrollbar styling */
      ::-webkit-scrollbar { width: 4px; }
      ::-webkit-scrollbar-track { background: transparent; }
      ::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.08); border-radius: 4px; }
      ::-webkit-scrollbar-thumb:hover { background: rgba(255,255,255,0.15); }
      /* Responsive 3-panel layout */
      .investor-3panel { min-height: 0; }
      @media (min-width: 1024px) {
        .investor-3panel { height: min(560px, calc(100vh - 300px)); min-height: 320px; }
      }
      /* Slide-in overlay from right (mobile right rail) */
      @keyframes slideInRight {
        from { transform: translateX(100%); opacity: 0; }
        to { transform: translateX(0); opacity: 1; }
      }
      .slide-in-right { animation: slideInRight 0.3s ease-out; }
      .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
      .scrollbar-hide::-webkit-scrollbar { display: none; }
      @keyframes coachmark-pulse {
        0%, 100% { box-shadow: 0 0 0 0 rgba(34,211,238,0.5); }
        50% { box-shadow: 0 0 0 8px rgba(34,211,238,0); }
      }
      @keyframes coachmark-slide-in {
        from { opacity: 0; transform: translateY(8px); }
        to { opacity: 1; transform: translateY(0); }
      }
    </style>
  </head>
  <body>
    <div id="root"></div>

    <script type="text/babel">
      const { useState, useEffect, useCallback, useMemo } = React;
      const API_BASE = "";
      const getDailyChange = window.TimedPriceUtils?.getDailyChange || (() => ({ dayPct: null, dayChg: null }));

      // â”€â”€â”€ Helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      function fmtPct(n) { return Number.isFinite(n) ? `${n >= 0 ? "+" : ""}${n.toFixed(1)}%` : "â€”"; }
      function fmtScore(n) { return Number.isFinite(n) ? n.toFixed(0) : "â€”"; }
      function fmtUsd(n) { return Number.isFinite(n) ? "$" + Math.abs(n).toLocaleString("en-US", { minimumFractionDigits: 2, maximumFractionDigits: 2 }) : "$0.00"; }

      function ScoreBar({ score, max = 100, color = "#3b82f6" }) {
        const pct = Math.max(0, Math.min(100, (score / max) * 100));
        return React.createElement("div", { className: "w-full h-1.5 rounded-full bg-white/[0.06] overflow-hidden" },
          React.createElement("div", { style: { width: `${pct}%`, background: color }, className: "h-full rounded-full transition-all duration-500" })
        );
      }

      function RegimeBadge({ regime }) {
        const colors = { RISK_ON: "text-[#00e676] bg-[#00c853]/10 border-[#00c853]/25", CAUTIOUS: "text-amber-400 bg-amber-500/10 border-amber-500/25", RISK_OFF: "text-red-400 bg-red-500/10 border-red-500/25" };
        const friendlyRegime = { RISK_ON: "Bullish", CAUTIOUS: "Cautious", RISK_OFF: "Bearish" };
        return React.createElement("span", { className: `px-2 py-0.5 rounded-md text-[11px] font-semibold border ${colors[regime] || colors.CAUTIOUS}`, title: regime }, friendlyRegime[regime] || regime);
      }

      function StageBadge({ stage }) {
        return React.createElement("span", { className: `stage-badge stage-${stage}` }, stage.replace("_", " "));
      }

      function TrendArrow({ direction }) {
        if (direction === 1 || direction === "uptrend" || direction === "bullish") {
          return React.createElement("span", { className: "text-[#00e676]", title: "Bullish" }, "â–²");
        }
        if (direction === -1 || direction === "downtrend" || direction === "bearish") {
          return React.createElement("span", { className: "text-red-400", title: "Bearish" }, "â–¼");
        }
        return React.createElement("span", { className: "text-gray-500", title: "Neutral" }, "â—");
      }

      const SIGNAL_LABELS = {
        rsi_oversold: "RSI is low (oversold)",
        above_monthly_ema: "Price above monthly trend line",
        monthly_trend_intact: "Monthly trend still healthy",
        weekly_trend_intact: "Weekly trend still healthy",
        above_weekly_ema: "Price above weekly trend line",
        rsi_divergence: "Momentum divergence detected",
        volume_climax: "Unusual selling volume (capitulation)",
        near_support: "Price near a support level",
      };

      const COMPONENT_LABELS = {
        weeklyTrend: { label: "Weekly Trend", tip: "Is the stock trending up or down on a weekly basis?", max: 25 },
        monthlyTrend: { label: "Monthly Trend", tip: "The bigger-picture direction over months", max: 20 },
        relativeStrength: { label: "Strength vs Market", tip: "How this stock performs compared to the S&P 500", max: 20 },
        accumulationSignal: { label: "Buy Zone Signal", tip: "Has the stock pulled back to a favorable entry price?", max: 15 },
        marketHealth: { label: "Market Conditions", tip: "Is the overall market environment supportive?", max: 10 },
        trendDurability: { label: "Trend Durability", tip: "How long and consistently the trend has held", max: 10 },
        sectorContext: { label: "Sector Context", tip: "Is this stock's sector in favor right now?", max: 10 },
      };

      function getScoreLabel(score) {
        if (score >= 70) return "Strong";
        if (score >= 50) return "Mixed";
        return "Weak";
      }

      function getTickerSummary(score, stage) {
        if (score >= 70 && stage === "accumulate") return "Strong setup. The system sees a buying opportunity.";
        if (score >= 70 && stage === "core_hold") return "Strong and steady. The system recommends holding.";
        if (score >= 70) return "Strong signals across the board.";
        if (score >= 50 && stage === "accumulate") return "Moderate setup with a buying opportunity. The system suggests smaller sizing.";
        if (score >= 50 && stage === "watch") return "Mixed signals. The system recommends watching for now.";
        if (score >= 50 && stage === "core_hold") return "Decent health but not firing on all cylinders. Hold and monitor.";
        if (score >= 50) return "Mixed signals â€” some positives, some caution flags.";
        if (score < 50 && stage === "reduce") return "Weak setup. The system recommends reducing or exiting.";
        if (score < 50 && stage === "watch") return "Weak signals. The system recommends caution.";
        if (score < 50) return "Unfavorable conditions. The system advises caution.";
        return "The system is evaluating this stock.";
      }

      function getRsSummary(rs) {
        if (!rs) return null;
        const pos = [rs.rs1m, rs.rs3m, rs.rs6m].filter(v => Number.isFinite(v) && v > 0).length;
        const neg = [rs.rs1m, rs.rs3m, rs.rs6m].filter(v => Number.isFinite(v) && v < 0).length;
        if (pos === 3) return "Outperforming the market across all timeframes.";
        if (pos >= 2) return "Generally outperforming, with some recent softness.";
        if (neg === 3) return "Underperforming the market. Relative weakness across the board.";
        if (neg >= 2) return "Mostly underperforming. The market is doing better.";
        return "Mixed performance relative to the market.";
      }

      // â”€â”€â”€ Market Health Bar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      function MarketHealthBar({ health, loading }) {
        if (!health) return React.createElement("div", { className: "card p-4 mb-4" },
          React.createElement("div", { className: "text-[#6b7280] text-sm" }, loading ? "Loading market health..." : "Market health data hasn't been calculated yet. It updates automatically during market hours.")
        );

        const { score, regime, breadth, components } = health;
        const color = score >= 70 ? "#10b981" : score >= 45 ? "#f59e0b" : "#ef4444";

        return React.createElement("div", { className: "card p-4 mb-4 fade-in" },
          React.createElement("div", { className: "flex items-center justify-between mb-1" },
            React.createElement("div", { className: "flex items-center gap-3" },
              React.createElement("h2", { className: "text-sm font-semibold text-white" }, "Market Health"),
              React.createElement(RegimeBadge, { regime }),
            ),
            React.createElement("div", { className: "flex items-center gap-2" },
              React.createElement("span", { className: "text-2xl font-bold", style: { color } }, score),
              React.createElement("span", { className: "text-[#6b7280] text-xs" }, "/ 100"),
            ),
          ),
          React.createElement("div", { className: "text-[11px] text-[#6b7280] mb-3" }, "How healthy is the overall stock market right now?"),
          React.createElement(ScoreBar, { score, color }),
          React.createElement("div", { className: "grid grid-cols-4 gap-4 mt-3" },
            (() => { const v = components?.breadth || 0; const c = v >= 20 ? "#00e676" : v >= 10 ? "#fbbf24" : "#f87171"; const w = v >= 20 ? "Strong" : v >= 10 ? "Fair" : "Weak"; return React.createElement("div", { className: "text-center" },
              React.createElement("div", { className: "text-[10px] text-[#6b7280] uppercase tracking-wide" }, "Participation"),
              React.createElement("div", { className: "flex items-baseline justify-center gap-1" },
                React.createElement("span", { className: "text-base font-semibold text-white" }, v),
                React.createElement("span", { className: "text-[10px] font-semibold", style: { color: c } }, w),
              ),
              React.createElement("div", { className: "text-[9px] text-[#4b5563] mt-0.5" }, "Stocks going up vs down"),
            ); })(),
            (() => { const v = components?.regimeScore || 0; const c = v >= 20 ? "#00e676" : v >= 10 ? "#fbbf24" : "#f87171"; const w = v >= 20 ? "Strong" : v >= 10 ? "Fair" : "Weak"; return React.createElement("div", { className: "text-center" },
              React.createElement("div", { className: "text-[10px] text-[#6b7280] uppercase tracking-wide" }, "Market Mode"),
              React.createElement("div", { className: "flex items-baseline justify-center gap-1" },
                React.createElement("span", { className: "text-base font-semibold text-white" }, v),
                React.createElement("span", { className: "text-[10px] font-semibold", style: { color: c } }, w),
              ),
              React.createElement("div", { className: "text-[9px] text-[#4b5563] mt-0.5" }, "Bullish, cautious, or bearish"),
            ); })(),
            (() => { const v = components?.trendMomentum || 0; const c = v >= 20 ? "#00e676" : v >= 10 ? "#fbbf24" : "#f87171"; const w = v >= 20 ? "Strong" : v >= 10 ? "Fair" : "Weak"; return React.createElement("div", { className: "text-center" },
              React.createElement("div", { className: "text-[10px] text-[#6b7280] uppercase tracking-wide" }, "Trend Strength"),
              React.createElement("div", { className: "flex items-baseline justify-center gap-1" },
                React.createElement("span", { className: "text-base font-semibold text-white" }, v),
                React.createElement("span", { className: "text-[10px] font-semibold", style: { color: c } }, w),
              ),
              React.createElement("div", { className: "text-[9px] text-[#4b5563] mt-0.5" }, "Trending up or losing steam"),
            ); })(),
            (() => { const v = breadth?.pctAboveW200; const n = Number(v) || 0; const c = n >= 60 ? "#00e676" : n >= 40 ? "#fbbf24" : "#f87171"; const w = n >= 60 ? "Healthy" : n >= 40 ? "Fair" : "Weak"; return React.createElement("div", { className: "text-center" },
              React.createElement("div", { className: "text-[10px] text-[#6b7280] uppercase tracking-wide" }, "Long-Term"),
              React.createElement("div", { className: "flex items-baseline justify-center gap-1" },
                React.createElement("span", { className: "text-base font-semibold text-white" }, v ? `${v}%` : "â€”"),
                v && React.createElement("span", { className: "text-[10px] font-semibold", style: { color: c } }, w),
              ),
              React.createElement("div", { className: "text-[9px] text-[#4b5563] mt-0.5" }, "Above 200-week average"),
            ); })(),
          ),
        );
      }

      // â”€â”€â”€ Action Board Header (inline score key, no toggle) â”€â”€â”€â”€â”€â”€â”€â”€â”€
      function ActionBoardHeader({ actionCount }) {
        return React.createElement("div", { className: "mb-3 shrink-0" },
          React.createElement("div", { className: "flex items-center justify-between mb-1" },
            React.createElement("h2", { className: "text-sm font-semibold text-white" },
              "Action Board",
              React.createElement("span", { className: "text-[10px] text-[#4b5563] ml-2 font-normal" }, `${actionCount} ticker${actionCount !== 1 ? "s" : ""} need attention`),
            ),
          ),
          React.createElement("div", { className: "flex items-center gap-3 text-[10px] text-[#6b7280]" },
            React.createElement("span", { className: "flex items-center gap-1" },
              React.createElement("span", { className: "w-1.5 h-1.5 rounded-full bg-[#00e676] inline-block" }),
              React.createElement("span", null, "70+ Strong"),
            ),
            React.createElement("span", { className: "flex items-center gap-1" },
              React.createElement("span", { className: "w-1.5 h-1.5 rounded-full bg-amber-400 inline-block" }),
              React.createElement("span", null, "50-69 Mixed"),
            ),
            React.createElement("span", { className: "flex items-center gap-1" },
              React.createElement("span", { className: "w-1.5 h-1.5 rounded-full bg-red-400 inline-block" }),
              React.createElement("span", null, "Under 50 Weak"),
            ),
            React.createElement("span", { className: "text-[#4b5563]" }, "|"),
            React.createElement("span", { className: "text-[9px] text-[#00e676] bg-[#00c853]/10 px-1 rounded", title: "The stock pulled back to a good buy area while its longer-term trend is still healthy" }, "ZONE"),
            React.createElement("span", { className: "text-[#4b5563]" }, "= buy area"),
            React.createElement("span", { className: "text-[9px] text-sky-400 bg-sky-500/10 px-1 rounded", title: "This stock is outperforming the S&P 500 at a new 3-month high" }, "RS HIGH"),
            React.createElement("span", { className: "text-[#4b5563]" }, "= beating the market"),
          ),
        );
      }

      // â”€â”€â”€ Investor Card (matches Active Trader CompactCard: 280px, glass, consistent layout) â”€â”€
      function InvestorCard({ t, onSelect, selectedTicker, savedTickers, toggleSavedTicker }) {
        const sym = String(t?.ticker || "").toUpperCase();
        const stage = t.stage || "research";
        const score = Number(t.score) || 0;
        const scoreCls = score >= 70 ? "text-[#00e676]" : score >= 50 ? "text-amber-400" : "text-red-400";
        const _dc = getDailyChange(t);
        const dayPct = _dc?.dayPct;
        const dayChg = _dc?.dayChg;
        const price = t.price != null && Number.isFinite(t.price) ? t.price : null;
        const isSelected = selectedTicker === sym;
        const glassBg = "rgba(10,16,28,0.45)";
        const cardBgImage = [
          "linear-gradient(170deg, rgba(255,255,255,0.07) 0%, rgba(255,255,255,0.02) 25%, transparent 55%)",
          "linear-gradient(to bottom, rgba(120,160,255,0.04) 0%, transparent 40%, rgba(0,0,0,0.15) 100%)",
          `linear-gradient(0deg, ${glassBg}, ${glassBg})`,
        ].join(", ");
        const stageColors = { accumulate: "#10b981", core_hold: "#3b82f6", watch: "#f59e0b", reduce: "#ef4444", research: "#8b5cf6", exited: "#6b7280" };
        const accentColor = stageColors[stage] || "#6b7280";

        return React.createElement("div", {
          key: sym,
          role: "button",
          tabIndex: 0,
          onClick: () => onSelect && onSelect(sym),
          onKeyDown: (e) => { if (e.key === "Enter" || e.key === " ") { e.preventDefault(); onSelect && onSelect(sym); } },
          className: `w-full text-left rounded-lg cursor-pointer hover:brightness-110 relative overflow-hidden border flex flex-col transition-all ${isSelected ? "border-white/30 bg-white/[0.08]" : "border-white/[0.08]"}`,
          style: { backgroundImage: cardBgImage, boxShadow: "0 4px 12px rgba(0,0,0,0.5), inset 0 1px 0 rgba(255,255,255,0.12)", height: "142px" },
        },
          React.createElement("div", { className: "absolute left-0 top-0 bottom-0 w-[3px] rounded-l-lg", style: { background: accentColor, boxShadow: `0 0 6px ${accentColor}66` } }),
          React.createElement("div", { className: "relative flex flex-col flex-1 min-h-0 p-2", style: { zIndex: 1 } },
            React.createElement("div", { className: "flex items-center justify-between" },
              React.createElement("div", { className: "flex items-center gap-1.5 min-w-0" },
                toggleSavedTicker && React.createElement("button", {
                  onClick: (e) => { e.stopPropagation(); toggleSavedTicker(sym); },
                  className: `text-[13px] hover:scale-110 transition-transform shrink-0 ${savedTickers?.has(sym) ? "text-amber-400" : "text-[#4b5563] hover:text-amber-300"}`,
                  title: savedTickers?.has(sym) ? "Remove from Saved" : "Add to Saved",
                }, savedTickers?.has(sym) ? "â˜…" : "â˜†"),
                React.createElement("div", { className: "flex flex-col min-w-0 shrink" },
                  React.createElement("span", { className: "text-xs font-bold text-white truncate" }, sym),
                  t.companyName && React.createElement("span", { className: "text-[9px] text-[#9ca3af] truncate", title: t.companyName }, t.companyName),
                ),
                React.createElement("span", { className: `stage-badge stage-${stage} !text-[8px] !py-0 !px-1 shrink-0` }, stage.replace("_", " ")),
              ),
              React.createElement("div", { className: "flex items-center gap-1.5 shrink-0" },
                price != null && React.createElement("span", { className: "text-[10px] text-[#9ca3af] tabular-nums" }, `$${price.toFixed(2)}`),
                (dayPct != null && Number.isFinite(dayPct)) && React.createElement("span", { className: `text-[10px] font-semibold tabular-nums ${dayPct >= 0 ? "text-[#00e676]" : "text-red-400"}` }, `${dayPct >= 0 ? "+" : ""}${dayPct.toFixed(1)}%`),
              ),
            ),
            React.createElement("div", { className: "flex items-center justify-between mt-1" },
              React.createElement("span", { className: `text-sm font-bold tabular-nums ${scoreCls}` }, Number.isFinite(score) ? score : "â€”"),
              React.createElement("span", { className: "flex items-center gap-1" },
                t.accumZone?.inZone && React.createElement("span", { className: "text-[9px] text-[#00e676] bg-[#00c853]/10 px-1 rounded" }, "ZONE"),
                t.rs?.rsNewHigh3m && React.createElement("span", { className: "text-[9px] text-sky-400 bg-sky-500/10 px-1 rounded" }, "RS HIGH"),
              ),
            ),
            React.createElement("div", { className: "mt-auto pt-1" },
              React.createElement(ScoreBar, { score: Math.min(100, Math.max(0, score)), color: score >= 70 ? "#10b981" : score >= 50 ? "#f59e0b" : "#ef4444" }),
            ),
          ),
        );
      }

      // â”€â”€â”€ Investor Kanban Column (matches Active Trader KanbanColumn: horizontal scroll, icon, count) â”€â”€
      function InvestorKanbanColumn({ laneKey, title, icon, color, count, items, renderCard, laneScrollRef }) {
        const listRef = React.useRef(null);
        React.useEffect(() => {
          try {
            const el = listRef.current;
            if (!el || !laneScrollRef?.current) return;
            const saved = laneScrollRef.current[laneKey];
            if (Number.isFinite(saved) && saved > 0) el.scrollLeft = saved;
          } catch {}
        }, [laneKey, items?.map(i => i.ticker).join(",")]);

        return React.createElement("div", { className: "flex items-stretch gap-0 mb-1 kanban-lane" },
          React.createElement("div", {
            className: "flex flex-col justify-center items-center min-w-[72px] w-[72px] shrink-0 rounded-l-xl border-l-2 border-t border-b border-t-white/[0.04] border-b-white/[0.04] px-1.5 py-2",
            style: { borderLeftColor: color, background: "linear-gradient(180deg, rgba(255,255,255,0.04) 0%, rgba(255,255,255,0.015) 100%)" },
            title: title,
          },
            React.createElement("span", { className: "text-[11px] font-semibold text-white/90 tracking-wide text-center leading-tight break-words" }, icon, React.createElement("br"), title),
            React.createElement("span", { className: `text-[10px] font-bold tabular-nums mt-0.5 ${count > 0 ? "text-white/80" : "text-[#4b5563]"}` }, count),
          ),
          React.createElement("div", {
            ref: listRef,
            className: "flex-1 rounded-r-xl border-t border-r border-b border-white/[0.04] p-1.5 overflow-x-auto scrollbar-hide",
            style: { overflowAnchor: "none", WebkitOverflowScrolling: "touch", background: "rgba(255,255,255,0.01)" },
            onScroll: () => {
              try {
                const el = listRef.current;
                if (el && laneScrollRef?.current) laneScrollRef.current[laneKey] = el.scrollLeft;
              } catch {}
            },
          },
            Array.isArray(items) && items.length > 0
              ? React.createElement("div", { className: "flex gap-1.5" },
                  items.slice(0, 80).map(t => React.createElement("div", { key: t.ticker, className: "w-[280px] shrink-0 kanban-card" }, renderCard(t))),
                )
              : React.createElement("div", { className: "text-[10px] text-[#4b5563] italic flex items-center h-full px-2 min-h-[80px]" }, "No tickers"),
          ),
        );
      }

      // â”€â”€â”€ Action Kanban (KanbanColumn-like lanes: Accumulate / Core Hold / Watch / Reduce) â”€â”€â”€â”€â”€â”€
      function ActionKanban({ tickers, onSelect, selectedTicker, savedTickers, toggleSavedTicker }) {
        const laneScrollRef = React.useRef({});
        const stages = ["accumulate", "core_hold", "watch", "reduce"];
        const stageMeta = {
          accumulate: { label: "Accumulate", icon: "ðŸ“ˆ", color: "#10b981", title: "Consider buying â€” price is in a favorable zone" },
          core_hold: { label: "Core Hold", icon: "ðŸ“Š", color: "#3b82f6", title: "Keep holding â€” trend and strength are solid" },
          watch: { label: "Watch", icon: "ðŸ‘", color: "#f59e0b", title: "Wait and monitor â€” signals are mixed" },
          reduce: { label: "Reduce", icon: "ðŸ“‰", color: "#ef4444", title: "Consider selling â€” showing signs of weakness" },
        };
        const grouped = {};
        for (const s of stages) grouped[s] = [];
        for (const t of tickers) {
          const stage = t.stage || "research";
          if (grouped[stage]) grouped[stage].push(t);
        }
        const renderCard = (t) => React.createElement(InvestorCard, { key: t.ticker, t, onSelect, selectedTicker, savedTickers: savedTickers || new Set(), toggleSavedTicker });

        return React.createElement("div", { className: "flex-1 overflow-y-auto space-y-1 min-h-0", "data-coachmark": "action-board" },
          ...stages.map(stage =>
            React.createElement(InvestorKanbanColumn, {
              key: stage,
              laneKey: stage,
              title: stageMeta[stage].label,
              icon: stageMeta[stage].icon,
              color: stageMeta[stage].color,
              count: grouped[stage].length,
              items: grouped[stage],
              renderCard,
              laneScrollRef,
            }),
          ),
        );
      }

      // â”€â”€â”€ Ticker List (scrollable viewport, no chrome) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      function TickerListViewport({ tickers, onSelect, selectedTicker, savedTickers, toggleSavedTicker }) {
        return React.createElement("div", { className: "flex-1 overflow-y-auto space-y-1 pr-0.5 min-h-0" },
          ...tickers.map(t =>
            React.createElement("div", {
              key: t.ticker,
              className: `card card-hover p-2 cursor-pointer transition-all ${selectedTicker === t.ticker ? "border-white/20 bg-white/[0.06]" : ""}`,
              onClick: () => onSelect(t.ticker),
            },
              React.createElement("div", { className: "flex items-center justify-between" },
                React.createElement("div", { className: "flex items-center gap-2 min-w-0" },
                  React.createElement("div", { className: "flex flex-col min-w-0" },
                    React.createElement("span", { className: "text-xs font-semibold text-white truncate" }, t.ticker),
                    t.companyName && React.createElement("span", { className: "text-[9px] text-[#6b7280] truncate", title: t.companyName }, t.companyName),
                  ),
                  React.createElement("span", { className: `stage-badge stage-${t.stage || "research"} !text-[8px] !py-0 !px-1` }, (t.stage || "research").replace("_", " ")),
                ),
                React.createElement("div", { className: "flex items-center gap-1.5 shrink-0" },
                  React.createElement("span", { className: `text-[11px] font-semibold tabular-nums ${t.score >= 70 ? "text-[#00e676]" : t.score >= 50 ? "text-amber-400" : "text-red-400"}` }, t.score),
                  React.createElement("button", {
                    onClick: (e) => { e.stopPropagation(); toggleSavedTicker(t.ticker); },
                    className: `text-[13px] hover:scale-110 transition-transform ${savedTickers.has(t.ticker) ? "text-amber-400" : "text-[#4b5563] hover:text-amber-300"}`,
                    title: savedTickers.has(t.ticker) ? "Remove from Saved" : "Add to Saved",
                  }, savedTickers.has(t.ticker) ? "â˜…" : "â˜†"),
                ),
              ),
              React.createElement("div", { className: "flex items-center justify-between mt-0.5" },
                React.createElement("span", { className: "text-[10px] text-[#6b7280] tabular-nums" },
                  t.price != null && Number.isFinite(t.price)
                    ? `$${t.price.toFixed(2)}`
                    : `RS: ${t.rsRank || "â€”"}`,
                ),
                React.createElement("span", { className: "flex items-center gap-1" },
                  (() => { const _dc = getDailyChange(t); const _dp = _dc?.dayPct; const _dv = _dc?.dayChg; const _sign = (_dp || 0) >= 0 ? "+" : ""; const _cls = (_dp || 0) >= 0 ? "text-[#00e676]" : "text-red-400"; return (_dp != null && Number.isFinite(_dp)) && React.createElement("span", { className: `text-[9px] tabular-nums font-medium ${_cls}` }, `${_sign}${_dp.toFixed(1)}%`, Number.isFinite(_dv) ? ` (${_sign}$${Math.abs(_dv).toFixed(2)})` : ""); })(),
                  t.accumZone?.inZone && React.createElement("span", { className: "text-[8px] text-[#00e676] bg-[#00c853]/10 px-1 rounded" }, "ZONE"),
                  t.rs?.rsNewHigh3m && React.createElement("span", { className: "text-[8px] text-sky-400 bg-sky-500/10 px-1 rounded" }, "RS HIGH"),
                ),
              ),
              React.createElement("div", { className: "mt-1" },
                React.createElement(ScoreBar, { score: t.score, color: t.score >= 70 ? "#10b981" : t.score >= 50 ? "#f59e0b" : "#ef4444" }),
              ),
            )
          ),
          tickers.length === 0 && React.createElement("div", { className: "text-[11px] text-[#4b5563] text-center py-8" }, "No matching tickers"),
        );
      }

      // â”€â”€â”€ Portfolio Section â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      function PortfolioSection({ portfolio }) {
        if (!portfolio || !portfolio.positionHealth?.length) {
          return React.createElement("div", { className: "card p-4 mb-4" },
            React.createElement("div", { className: "text-[#6b7280] text-sm" }, "Portfolio analysis will appear here once the portfolio has open positions."),
          );
        }

        const { sectorAllocation, concentrationRisk, diversificationScore, positionHealth, suggestions } = portfolio;

        return React.createElement("div", { className: "card p-4 mb-4 fade-in" },
          React.createElement("h2", { className: "text-sm font-semibold text-white mb-1" }, "Portfolio Analytics"),
          React.createElement("div", { className: "text-[11px] text-[#6b7280] mb-3" }, "How well the simulated portfolio is balanced and where the system sees room for improvement."),
          // Metrics row
          React.createElement("div", { className: "grid grid-cols-3 gap-4 mb-4" },
            React.createElement("div", { className: "card p-3 text-center" },
              React.createElement("div", { className: "text-[10px] text-[#6b7280] uppercase tracking-wide" }, "Diversification"),
              React.createElement("div", { className: `text-xl font-bold ${diversificationScore >= 60 ? "text-[#00e676]" : diversificationScore >= 40 ? "text-amber-400" : "text-red-400"}` }, diversificationScore),
              React.createElement(ScoreBar, { score: diversificationScore, color: diversificationScore >= 60 ? "#10b981" : "#f59e0b" }),
              React.createElement("div", { className: "text-[9px] text-[#4b5563] mt-1" }, "How spread out is the portfolio?"),
            ),
            React.createElement("div", { className: "card p-3 text-center" },
              React.createElement("div", { className: "text-[10px] text-[#6b7280] uppercase tracking-wide" }, "Top-Heavy Risk"),
              React.createElement("div", { className: `text-xl font-bold ${concentrationRisk.rating === "GOOD" ? "text-[#00e676]" : concentrationRisk.rating === "MODERATE" ? "text-amber-400" : "text-red-400"}` }, `${concentrationRisk.top3Pct}%`),
              React.createElement("div", { className: "text-[10px] text-[#6b7280]" }, `Top 3 = ${concentrationRisk.top3Pct}%`),
              React.createElement("div", { className: "text-[9px] text-[#4b5563] mt-0.5" }, concentrationRisk.rating === "GOOD" ? "Healthy â€” well distributed" : concentrationRisk.rating === "MODERATE" ? "Moderate â€” could be more spread out" : "High risk â€” too concentrated"),
            ),
            React.createElement("div", { className: "card p-3 text-center" },
              React.createElement("div", { className: "text-[10px] text-[#6b7280] uppercase tracking-wide" }, "Industries"),
              React.createElement("div", { className: "text-xl font-bold text-white" }, Object.keys(sectorAllocation).length),
              React.createElement("div", { className: "text-[9px] text-[#4b5563] mt-0.5" }, "Different sectors held"),
            ),
          ),
          // Sector allocation
          React.createElement("div", { className: "mb-4" },
            React.createElement("h3", { className: "text-xs font-semibold text-[#9ca3af] mb-1 uppercase tracking-wide" }, "Sector Allocation"),
            React.createElement("div", { className: "text-[10px] text-[#4b5563] mb-2" }, "What percentage of the portfolio is allocated to each industry."),
            React.createElement("div", { className: "space-y-1" },
              ...Object.entries(sectorAllocation)
                .sort((a, b) => b[1].weight - a[1].weight)
                .map(([sector, data]) =>
                  React.createElement("div", { key: sector, className: "flex items-center gap-2" },
                    React.createElement("span", { className: "text-xs text-[#9ca3af] w-28 truncate" }, sector),
                    React.createElement("div", { className: "flex-1", title: data.weight > 30 ? "More than 30% in one sector increases portfolio risk if that industry underperforms" : "" },
                      React.createElement(ScoreBar, { score: data.weight, color: data.weight > 30 ? "#ef4444" : "#3b82f6" }),
                    ),
                    React.createElement("span", { className: "text-xs text-white w-12 text-right" }, `${data.weight}%`),
                  )
                ),
            ),
          ),
          // Position health table
          React.createElement("div", { className: "mb-4" },
            React.createElement("h3", { className: "text-xs font-semibold text-[#9ca3af] mb-1 uppercase tracking-wide" }, "Position Health"),
            React.createElement("div", { className: "text-[10px] text-[#4b5563] mb-2" }, "How each position in the portfolio is performing."),
            React.createElement("div", { className: "overflow-x-auto" },
              React.createElement("table", { className: "w-full text-xs" },
                React.createElement("thead", null,
                  React.createElement("tr", { className: "text-[#6b7280] border-b border-white/[0.06]" },
                    React.createElement("th", { className: "text-left py-1.5 font-medium" }, "Ticker"),
                    React.createElement("th", { className: "text-right py-1.5 font-medium", title: "Profit or loss on this position" }, "Gain/Loss"),
                    React.createElement("th", { className: "text-right py-1.5 font-medium", title: "The system's overall health score for this stock" }, "Health"),
                    React.createElement("th", { className: "text-right py-1.5 font-medium", title: "How this stock performs vs all other tracked stocks relative to the S&P 500" }, "vs Market"),
                    React.createElement("th", { className: "text-right py-1.5 font-medium", title: "What percentage of the portfolio this position represents" }, "Portfolio %"),
                    React.createElement("th", { className: "text-left py-1.5 font-medium pl-2" }, "Sector"),
                  ),
                ),
                React.createElement("tbody", null,
                  ...positionHealth.sort((a, b) => (b.investorScore || 0) - (a.investorScore || 0)).map(ph =>
                    React.createElement("tr", { key: ph.ticker, className: "border-b border-white/[0.03] hover:bg-white/[0.02]" },
                      React.createElement("td", { className: "py-1.5 font-semibold text-white" }, ph.ticker),
                      React.createElement("td", { className: `py-1.5 text-right ${ph.pnlPct >= 0 ? "text-[#00e676]" : "text-red-400"}` }, fmtPct(ph.pnlPct)),
                      React.createElement("td", { className: "py-1.5 text-right text-white" }, ph.investorScore || "â€”"),
                      React.createElement("td", { className: "py-1.5 text-right text-white" }, ph.rsRank || "â€”"),
                      React.createElement("td", { className: "py-1.5 text-right text-[#9ca3af]" }, `${ph.weight}%`),
                      React.createElement("td", { className: "py-1.5 pl-2 text-[#6b7280]" }, ph.sector),
                    )
                  ),
                ),
              ),
            ),
          ),
          // Suggestions
          suggestions?.length > 0 && React.createElement("div", null,
            React.createElement("h3", { className: "text-xs font-semibold text-[#9ca3af] mb-1 uppercase tracking-wide" }, "Suggested Actions"),
            React.createElement("div", { className: "text-[10px] text-[#4b5563] mb-2" }, "Steps the system recommends to improve portfolio balance."),
            React.createElement("div", { className: "space-y-1.5" },
              ...suggestions.map((s, i) =>
                React.createElement("div", { key: i, className: `card p-2 text-xs ${s.priority === "high" ? "border-red-500/30" : s.priority === "medium" ? "border-amber-500/30" : "border-white/[0.06]"}` },
                  React.createElement("div", { className: "flex items-center gap-2" },
                    React.createElement("span", { className: `w-1.5 h-1.5 rounded-full ${s.priority === "high" ? "bg-red-400" : s.priority === "medium" ? "bg-amber-400" : "bg-blue-400"}` }),
                    React.createElement("span", { className: "text-[#d1d5db]" }, s.message),
                  ),
                )
              ),
            ),
          ),
        );
      }

      // â”€â”€â”€ Ticker Deep Dive (Right Rail) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      function TickerDeepDive({ ticker, data }) {
        if (!ticker || !data) return React.createElement("div", { className: "card p-6 text-center text-[#6b7280] text-sm" },
          React.createElement("div", { className: "text-lg mb-2 opacity-30" }, "â†"),
          "Select a ticker to see the full analysis",
        );

        const price = data.price;
        const _dcResult = getDailyChange(data);
        const chgPct = _dcResult?.dayPct ?? null;
        const chgVal = _dcResult?.dayChg ?? null;
        const hasPrice = price != null && Number.isFinite(price);
        const scoreLabel = getScoreLabel(data.score);
        const scoreColor = data.score >= 70 ? "text-[#00e676]" : data.score >= 50 ? "text-amber-400" : "text-red-400";
        const summary = getTickerSummary(data.score, data.stage);

        return React.createElement("div", { className: "card p-5 fade-in space-y-5" },
          // â”€â”€ Header: ticker + score with context â”€â”€
          React.createElement("div", null,
            React.createElement("div", { className: "flex items-center justify-between" },
              React.createElement("div", null,
                React.createElement("h2", { className: "text-lg font-bold text-white" }, ticker),
                data.companyName && React.createElement("div", { className: "text-xs text-[#9ca3af]" }, data.companyName),
                React.createElement("span", { className: "text-[10px] text-[#6b7280]" }, data.sector || "Unknown"),
              ),
              React.createElement("div", { className: "text-right" },
                React.createElement("div", { className: "flex items-baseline gap-1.5 justify-end" },
                  React.createElement("span", { className: `text-2xl font-bold ${scoreColor}` }, data.score),
                  React.createElement("span", { className: `text-xs font-semibold ${scoreColor}` }, scoreLabel),
                ),
                React.createElement("div", { className: "text-[10px] text-[#6b7280]" }, "Investor Score"),
              ),
            ),
            React.createElement("div", { className: "text-[11px] text-[#9ca3af] mt-2 italic leading-relaxed" }, summary),
          ),
          // â”€â”€ Price + Daily Change â”€â”€
          hasPrice && React.createElement("div", { className: "card p-3 flex items-center justify-between" },
            React.createElement("div", null,
              React.createElement("div", { className: "text-[10px] text-[#6b7280] uppercase tracking-wide" }, "Price"),
              React.createElement("div", { className: "text-lg font-bold text-white tabular-nums" }, `$${price.toFixed(2)}`),
            ),
            (chgPct != null && Number.isFinite(chgPct)) && React.createElement("div", { className: "text-right" },
              React.createElement("div", { className: "text-[10px] text-[#6b7280] uppercase tracking-wide" }, "Today"),
              React.createElement("div", { className: `text-lg font-bold tabular-nums ${chgPct >= 0 ? "text-[#00e676]" : "text-red-400"}` }, `${chgPct >= 0 ? "+" : ""}${chgPct.toFixed(2)}%`),
              Number.isFinite(chgVal) && React.createElement("div", { className: `text-[11px] font-medium tabular-nums ${chgVal >= 0 ? "text-[#00e676]/70" : "text-red-400/70"}` }, `${chgVal >= 0 ? "+" : "-"}$${Math.abs(chgVal).toFixed(2)}`),
            ),
            data.prevClose != null && Number.isFinite(data.prevClose) && React.createElement("div", { className: "text-right" },
              React.createElement("div", { className: "text-[10px] text-[#6b7280] uppercase tracking-wide" }, "Yesterday's Close"),
              React.createElement("div", { className: "text-sm font-semibold text-[#9ca3af] tabular-nums" }, `$${data.prevClose.toFixed(2)}`),
            ),
          ),
          // â”€â”€ Stage + action hint â”€â”€
          React.createElement("div", null,
            React.createElement("div", { className: "flex items-center gap-2 mb-1" },
              React.createElement(StageBadge, { stage: data.stage }),
              data.stage === "accumulate" && React.createElement("span", {
                className: "text-[10px] text-[#00e676]/80 bg-[#00c853]/10 px-2 py-0.5 rounded border border-[#00c853]/20",
              }, "Buy signal â€” add in small portions"),
              data.stage === "watch" && React.createElement("span", {
                className: "text-[10px] text-amber-400/80 bg-amber-500/10 px-2 py-0.5 rounded border border-amber-500/20",
              }, "The system suggests a small starter position"),
              data.stage === "reduce" && React.createElement("span", {
                className: "text-[10px] text-red-400/80 bg-red-500/10 px-2 py-0.5 rounded border border-red-500/20",
              }, "Reduce signal â€” the system recommends trimming"),
            ),
            data.stageReason && React.createElement("div", { className: "text-[10px] text-[#6b7280]" }, data.stageReason),
          ),
          // â”€â”€ Score Breakdown with verdict dots â”€â”€
          data.components && React.createElement("div", null,
            React.createElement("h3", { className: "text-xs font-semibold text-[#9ca3af] mb-1 uppercase tracking-wide" }, "Score Breakdown"),
            React.createElement("div", { className: "text-[10px] text-[#4b5563] mb-2.5" }, "How the system arrived at this stock's overall score."),
            React.createElement("div", { className: "space-y-2" },
              ...Object.entries(data.components).map(([k, v]) => {
                const meta = COMPONENT_LABELS[k] || { label: k.replace(/([A-Z])/g, " $1").trim(), tip: "", max: 10 };
                const maxVal = meta.max || 10;
                const pct = v / maxVal;
                const dotColor = pct >= 0.6 ? "bg-[#00e676]" : pct >= 0.3 ? "bg-amber-400" : "bg-red-400";
                return React.createElement("div", { key: k, className: "flex items-center gap-2", title: meta.tip },
                  React.createElement("span", { className: `w-1.5 h-1.5 rounded-full ${dotColor} shrink-0` }),
                  React.createElement("span", { className: "text-[11px] text-[#9ca3af] w-28 shrink-0" }, meta.label),
                  React.createElement("div", { className: "flex-1" },
                    React.createElement(ScoreBar, { score: v, max: maxVal, color: "#3b82f6" }),
                  ),
                  React.createElement("span", { className: "text-xs text-white w-6 text-right tabular-nums shrink-0" }, v),
                );
              }),
            ),
          ),
          // â”€â”€ Performance vs Market â”€â”€
          data.rs && React.createElement("div", null,
            React.createElement("h3", { className: "text-xs font-semibold text-[#9ca3af] mb-1 uppercase tracking-wide" }, "Performance vs Market"),
            React.createElement("div", { className: "text-[10px] text-[#4b5563] mb-2.5" }, getRsSummary(data.rs)),
            React.createElement("div", { className: "grid grid-cols-3 gap-2" },
              React.createElement("div", { className: "card p-2.5 text-center" },
                React.createElement("div", { className: "text-[10px] text-[#6b7280]" }, "1 Month"),
                React.createElement("div", { className: `text-sm font-semibold ${data.rs.rs1m >= 0 ? "text-[#00e676]" : "text-red-400"}` }, fmtPct(data.rs.rs1m)),
              ),
              React.createElement("div", { className: "card p-2.5 text-center" },
                React.createElement("div", { className: "text-[10px] text-[#6b7280]" }, "3 Months"),
                React.createElement("div", { className: `text-sm font-semibold ${data.rs.rs3m >= 0 ? "text-[#00e676]" : "text-red-400"}` }, fmtPct(data.rs.rs3m)),
              ),
              React.createElement("div", { className: "card p-2.5 text-center" },
                React.createElement("div", { className: "text-[10px] text-[#6b7280]" }, "6 Months"),
                React.createElement("div", { className: `text-sm font-semibold ${data.rs.rs6m >= 0 ? "text-[#00e676]" : "text-red-400"}` }, fmtPct(data.rs.rs6m)),
              ),
            ),
            React.createElement("div", { className: "mt-2.5" },
              React.createElement("div", { className: "flex items-center justify-between mb-1" },
                React.createElement("span", { className: "text-[11px] text-[#9ca3af]", title: "Relative Strength Rank â€” compares this stock's performance against every other tracked stock, relative to the S&P 500" },
                  `Outperforms ${data.rsRank}% of all tracked stocks`,
                ),
                React.createElement("div", { className: "flex items-center gap-1" },
                  data.rs.rsNewHigh3m && React.createElement("span", { className: "text-[9px] text-sky-400 bg-sky-500/10 px-1.5 py-0.5 rounded", title: "This stock just hit a new 3-month high in relative strength vs the market" }, "3M Best"),
                  data.rs.rsNewHigh6m && React.createElement("span", { className: "text-[9px] text-[#00e676] bg-[#00c853]/10 px-1.5 py-0.5 rounded", title: "This stock just hit a new 6-month high in relative strength vs the market" }, "6M Best"),
                ),
              ),
              React.createElement(ScoreBar, { score: data.rsRank || 0, color: (data.rsRank || 0) >= 70 ? "#10b981" : (data.rsRank || 0) >= 40 ? "#3b82f6" : "#ef4444" }),
            ),
          ),
          // â”€â”€ Buy Zone â”€â”€
          data.accumZone && React.createElement("div", null,
            React.createElement("h3", { className: "text-xs font-semibold text-[#9ca3af] mb-1 uppercase tracking-wide", title: "Has the stock pulled back to an attractive price while its longer-term trend is still healthy? (Accumulation Zone)" }, "Buy Zone"),
            data.accumZone.inZone
              ? React.createElement("div", { className: "card p-3 border-[#00c853]/30" },
                  React.createElement("div", { className: "flex items-center gap-2 mb-1.5" },
                    React.createElement("span", { className: "w-2 h-2 rounded-full bg-[#00e676] animate-pulse" }),
                    React.createElement("span", { className: "text-xs text-[#00e676] font-semibold" }, "In Buy Zone"),
                    React.createElement("span", { className: "text-[10px] text-[#9ca3af]" }, `${data.accumZone.confidence}% confidence`),
                  ),
                  React.createElement("div", { className: "text-[11px] text-[#9ca3af] leading-relaxed mb-2" }, "The stock dipped to a favorable price without breaking its uptrend â€” historically a good area to start buying."),
                  React.createElement("div", { className: "text-[10px] text-[#6b7280] mb-1" }, `${data.accumZone.signals?.length || 0} of 5 signals active:`),
                  React.createElement("div", { className: "flex flex-wrap gap-1" },
                    ...data.accumZone.signals.map((s, i) =>
                      React.createElement("span", { key: i, className: "text-[9px] px-1.5 py-0.5 rounded bg-white/[0.04] text-[#9ca3af]" }, SIGNAL_LABELS[s] || s.replace(/_/g, " "))
                    ),
                  ),
                )
              : React.createElement("div", { className: "text-[11px] text-[#6b7280] leading-relaxed" }, "Not in a buy zone right now. The stock hasn't pulled back to a favorable entry point yet."),
          ),
          // â”€â”€ Thesis â”€â”€
          data.thesis && React.createElement("div", null,
            React.createElement("h3", { className: "text-xs font-semibold text-[#9ca3af] mb-1 uppercase tracking-wide" }, "Investment Thesis"),
            React.createElement("div", { className: "text-[10px] text-[#4b5563] mb-2" }, "Why the system is tracking this stock and what would change the outlook."),
            React.createElement("div", { className: "text-xs text-[#d1d5db] leading-relaxed mb-2" }, data.thesis),
            data.thesisInvalidation?.length > 0 && React.createElement("div", null,
              React.createElement("div", { className: "text-[10px] text-[#6b7280] mb-1" }, "What would change this view:"),
              ...data.thesisInvalidation.map((inv, i) =>
                React.createElement("div", { key: i, className: "text-[11px] text-red-400/80 pl-2" }, `â€¢ ${inv}`)
              ),
            ),
          ),
        );
      }

      // â”€â”€â”€ Investor Welcome Modal (first-visit guide) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      function InvestorWelcomeModal({ onClose }) {
        const [step, setStep] = React.useState(0);
        const steps = [
          {
            title: "Welcome to the Investor Dashboard",
            body: React.createElement("div", { className: "space-y-4" },
              React.createElement("p", { className: "text-[#d1d5db] leading-relaxed" },
                "This platform takes a systematic approach to picking and managing stocks. The system continuously scores every stock across multiple timeframes, then places them in ",
                React.createElement("strong", { className: "text-white" }, "action lanes"),
                " based on where each stock is in its trend cycle."
              ),
              React.createElement("div", { className: "grid grid-cols-1 sm:grid-cols-2 gap-3" },
                React.createElement("div", { className: "bg-white/[0.03] border border-white/[0.06] rounded-lg p-4" },
                  React.createElement("h3", { className: "text-teal-400 font-semibold mb-1.5 text-sm" }, "Active Trader"),
                  React.createElement("p", { className: "text-xs text-[#9ca3af] leading-relaxed" },
                    "Shorter-horizon swing trades. The system enters, manages, and exits positions over days to weeks. Best for tracking fast-moving setups."
                  ),
                ),
                React.createElement("div", { className: "bg-white/[0.03] border border-blue-500/20 rounded-lg p-4 ring-1 ring-blue-500/10" },
                  React.createElement("h3", { className: "text-blue-400 font-semibold mb-1.5 text-sm" }, "Investor (this page)"),
                  React.createElement("p", { className: "text-xs text-[#9ca3af] leading-relaxed" },
                    "Longer-horizon portfolio management. The system accumulates strong setups, holds through strength, and reduces when conditions weaken. Designed for building positions over weeks to months."
                  ),
                ),
              ),
            ),
          },
          {
            title: "The Action Board",
            body: React.createElement("div", { className: "space-y-3" },
              React.createElement("p", { className: "text-[#d1d5db] text-sm leading-relaxed" },
                "The 4-column board is the core of the Investor experience. Each column represents an action the system recommends for the stocks placed there."
              ),
              React.createElement("div", { className: "space-y-2" },
                React.createElement("div", { className: "flex items-start gap-3 bg-white/[0.03] border border-white/[0.06] rounded-lg p-3" },
                  React.createElement("span", { className: "stage-badge stage-accumulate shrink-0 mt-0.5" }, "Accumulate"),
                  React.createElement("p", { className: "text-xs text-[#9ca3af] leading-relaxed" }, "The stock pulled back to a favorable price while its trend is intact. The system recommends building a position in small pieces over time."),
                ),
                React.createElement("div", { className: "flex items-start gap-3 bg-white/[0.03] border border-white/[0.06] rounded-lg p-3" },
                  React.createElement("span", { className: "stage-badge stage-core_hold shrink-0 mt-0.5" }, "Core Hold"),
                  React.createElement("p", { className: "text-xs text-[#9ca3af] leading-relaxed" }, "Both the weekly and monthly trends are healthy. No action needed \u2014 the system recommends holding."),
                ),
                React.createElement("div", { className: "flex items-start gap-3 bg-white/[0.03] border border-white/[0.06] rounded-lg p-3" },
                  React.createElement("span", { className: "stage-badge stage-watch shrink-0 mt-0.5" }, "Watch"),
                  React.createElement("p", { className: "text-xs text-[#9ca3af] leading-relaxed" }, "Mixed signals. Something changed \u2014 perhaps the trend weakened or relative strength dipped. The system recommends waiting before adding capital."),
                ),
                React.createElement("div", { className: "flex items-start gap-3 bg-white/[0.03] border border-white/[0.06] rounded-lg p-3" },
                  React.createElement("span", { className: "stage-badge stage-reduce shrink-0 mt-0.5" }, "Reduce"),
                  React.createElement("p", { className: "text-xs text-[#9ca3af] leading-relaxed" }, "The stock is showing weakness. The system recommends trimming or exiting the position to protect capital."),
                ),
              ),
            ),
          },
          {
            title: "Scores & Market Health",
            body: React.createElement("div", { className: "space-y-4" },
              React.createElement("div", { className: "bg-white/[0.03] border border-white/[0.06] rounded-lg p-4" },
                React.createElement("h3", { className: "text-teal-400 font-semibold mb-1.5 text-sm" }, "Investor Score (0\u2013100)"),
                React.createElement("p", { className: "text-xs text-[#9ca3af] leading-relaxed mb-2" },
                  "Every stock receives a score based on trend health, relative strength, and timing signals."
                ),
                React.createElement("div", { className: "flex gap-4 text-xs" },
                  React.createElement("span", null, React.createElement("span", { className: "inline-block w-2 h-2 rounded-full bg-[#00e676] mr-1" }), React.createElement("span", { className: "text-[#9ca3af]" }, "70+ Strong")),
                  React.createElement("span", null, React.createElement("span", { className: "inline-block w-2 h-2 rounded-full bg-amber-400 mr-1" }), React.createElement("span", { className: "text-[#9ca3af]" }, "50\u201369 Mixed")),
                  React.createElement("span", null, React.createElement("span", { className: "inline-block w-2 h-2 rounded-full bg-red-400 mr-1" }), React.createElement("span", { className: "text-[#9ca3af]" }, "Under 50 Weak")),
                ),
              ),
              React.createElement("div", { className: "bg-white/[0.03] border border-white/[0.06] rounded-lg p-4" },
                React.createElement("h3", { className: "text-teal-400 font-semibold mb-1.5 text-sm" }, "Market Health Bar"),
                React.createElement("p", { className: "text-xs text-[#9ca3af] leading-relaxed" },
                  "The bar at the top shows the overall market environment \u2014 Participation (breadth), Market Mode (bullish/cautious/bearish), Trend Strength, and Long-Term health. These help the system decide whether conditions are favorable for accumulation or whether caution is warranted."
                ),
              ),
              React.createElement("div", { className: "bg-white/[0.03] border border-white/[0.06] rounded-lg p-4" },
                React.createElement("h3", { className: "text-teal-400 font-semibold mb-1.5 text-sm" }, "Account Summary"),
                React.createElement("p", { className: "text-xs text-[#9ca3af] leading-relaxed" },
                  "The compact row below Market Health shows the simulated portfolio\u2019s total value, available cash, capital currently invested, and open/closed profit & loss."
                ),
              ),
            ),
          },
          {
            title: "The Right Rail \u2014 Deep Dive",
            body: React.createElement("div", { className: "space-y-4" },
              React.createElement("p", { className: "text-[#d1d5db] text-sm leading-relaxed" },
                "Click any ticker on the board or in the left list to open the Right Rail \u2014 a full analysis panel."
              ),
              React.createElement("div", { className: "bg-white/[0.03] border border-white/[0.06] rounded-lg p-4 space-y-2" },
                React.createElement("div", { className: "flex items-start gap-2" },
                  React.createElement("span", { className: "text-teal-400 text-sm mt-0.5" }, "\u2022"),
                  React.createElement("p", { className: "text-xs text-[#9ca3af] leading-relaxed" }, "A plain-English summary at the top (e.g., \u201CStrong setup. The system sees a buying opportunity.\u201D)"),
                ),
                React.createElement("div", { className: "flex items-start gap-2" },
                  React.createElement("span", { className: "text-teal-400 text-sm mt-0.5" }, "\u2022"),
                  React.createElement("p", { className: "text-xs text-[#9ca3af] leading-relaxed" }, "Score breakdown showing which factors are strong (green) vs weak (red)"),
                ),
                React.createElement("div", { className: "flex items-start gap-2" },
                  React.createElement("span", { className: "text-teal-400 text-sm mt-0.5" }, "\u2022"),
                  React.createElement("p", { className: "text-xs text-[#9ca3af] leading-relaxed" }, "Performance vs the market across multiple timeframes"),
                ),
                React.createElement("div", { className: "flex items-start gap-2" },
                  React.createElement("span", { className: "text-teal-400 text-sm mt-0.5" }, "\u2022"),
                  React.createElement("p", { className: "text-xs text-[#9ca3af] leading-relaxed" }, "Buy Zone indicator \u2014 whether the stock is at a favorable entry point"),
                ),
              ),
            ),
          },
          {
            title: "Reviewing the Simulation Portfolio",
            body: React.createElement("div", { className: "space-y-4" },
              React.createElement("p", { className: "text-[#d1d5db] text-sm leading-relaxed" },
                "The system runs a simulation portfolio that automatically executes trades based on scores and signals. This is not a live brokerage \u2014 it is a model portfolio that demonstrates how the system would manage positions."
              ),
              React.createElement("div", { className: "bg-white/[0.03] border border-white/[0.06] rounded-lg p-4" },
                React.createElement("h3", { className: "text-teal-400 font-semibold mb-1.5 text-sm" }, "Portfolio Analytics (below the board)"),
                React.createElement("p", { className: "text-xs text-[#9ca3af] leading-relaxed" },
                  "Shows diversification, sector allocation, position health, and suggested actions for every position in the simulation portfolio."
                ),
              ),
              React.createElement("div", { className: "bg-white/[0.03] border border-white/[0.06] rounded-lg p-4" },
                React.createElement("h3", { className: "text-teal-400 font-semibold mb-1.5 text-sm" }, "Trades Page (in the navigation)"),
                React.createElement("p", { className: "text-xs text-[#9ca3af] leading-relaxed" },
                  "To see every individual trade the system has taken \u2014 entries, trims, exits, and P&L \u2014 visit the ",
                  React.createElement("strong", { className: "text-white" }, "Trades"),
                  " page from the navigation bar. It shows open positions, closed trades, win rate, and detailed execution history."
                ),
              ),
            ),
          },
          {
            title: "Ready to Explore",
            body: React.createElement("div", { className: "space-y-4" },
              React.createElement("p", { className: "text-[#d1d5db] text-sm leading-relaxed" },
                "Click any ticker on the board or in the left list to start. The Right Rail shows everything the system knows about that stock."
              ),
              React.createElement("div", { className: "bg-white/[0.03] border border-white/[0.06] rounded-lg p-4" },
                React.createElement("div", { className: "flex items-start gap-2" },
                  React.createElement("span", { className: "text-blue-400 text-sm mt-0.5" }, "\u2139"),
                  React.createElement("p", { className: "text-xs text-[#9ca3af] leading-relaxed" },
                    "Reopen this guide anytime using the ",
                    React.createElement("strong", { className: "text-white" }, "Guide"),
                    " button in the navigation. Use the ",
                    React.createElement("strong", { className: "text-white" }, "Tour"),
                    " button to walk through the interface step by step."
                  ),
                ),
              ),
            ),
          },
        ];

        const cur = steps[step];

        return React.createElement("div", { className: "fixed inset-0 bg-black/80 backdrop-blur-sm z-[60] flex items-center justify-center p-4" },
          React.createElement("div", { className: "bg-[#0f1117] border-2 border-white/[0.06] rounded-xl max-w-2xl w-full max-h-[90vh] overflow-hidden flex flex-col shadow-lg" },
            React.createElement("div", { className: "bg-gradient-to-r from-blue-500/20 to-teal-500/20 border-b border-white/[0.06] p-6 flex items-center justify-between" },
              React.createElement("div", null,
                React.createElement("h2", { className: "text-xl font-bold text-white mb-1.5" }, cur.title),
                React.createElement("div", { className: "flex gap-1" },
                  ...steps.map((_, i) => React.createElement("div", {
                    key: i,
                    className: `h-2 rounded-full transition-all ${i === step ? "bg-blue-400 w-8" : i < step ? "bg-teal-400 w-2" : "bg-white/[0.04] w-2"}`,
                  })),
                ),
              ),
              React.createElement("button", {
                onClick: onClose,
                className: "text-[#6b7280] hover:text-white text-2xl font-bold w-8 h-8 flex items-center justify-center rounded hover:bg-white/[0.04] transition-colors",
                title: "Close guide",
              }, "\u00d7"),
            ),
            React.createElement("div", { className: "flex-1 overflow-y-auto p-6" }, cur.body),
            React.createElement("div", { className: "border-t border-white/[0.06] p-4 flex items-center justify-between bg-white/[0.03]" },
              React.createElement("button", {
                onClick: () => setStep(s => s - 1),
                disabled: step === 0,
                className: `px-4 py-2 rounded-lg border transition-all ${step === 0 ? "border-white/[0.06] text-[#6b7280] opacity-50 cursor-not-allowed" : "border-white/[0.06] bg-white/5 hover:bg-white/[0.04] text-white"}`,
              }, "\u2190 Previous"),
              React.createElement("span", { className: "text-sm text-[#6b7280]" }, `Step ${step + 1} of ${steps.length}`),
              step < steps.length - 1
                ? React.createElement("button", {
                    onClick: () => setStep(s => s + 1),
                    className: "px-6 py-2 rounded-lg bg-gradient-to-r from-blue-500 to-teal-500 hover:from-blue-600 hover:to-teal-600 text-white font-semibold transition-all",
                  }, "Next \u2192")
                : React.createElement("button", {
                    onClick: onClose,
                    className: "px-6 py-2 rounded-lg bg-gradient-to-r from-green-500 to-blue-500 hover:from-green-600 hover:to-blue-600 text-white font-semibold transition-all",
                  }, "Let\u2019s go"),
            ),
          ),
        );
      }

      // â”€â”€â”€ Investor Coachmarks (spotlight tour) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      const INVESTOR_COACHMARK_STEPS = [
        { target: "[data-coachmark='market-health']", title: "Market Health", body: "The overall market environment at a glance. Green values indicate conditions favorable for accumulation, amber signals caution, and red suggests defensive positioning.", position: "bottom", icon: "pulse" },
        { target: "[data-coachmark='action-board']", title: "Action Board", body: "Stocks flow between Accumulate, Core Hold, Watch, and Reduce based on their scores and trend health. Each column represents the system\u2019s recommendation for those stocks.", position: "top", icon: "columns" },
        { target: "[data-coachmark='ticker-list']", title: "Ticker List", body: "A scrollable ranked list of all tracked stocks sorted by score. Click any ticker to see its full analysis in the Right Rail.", position: "right", icon: "list" },
        { target: "[data-coachmark='right-rail']", title: "Deep Dive", body: "The detailed analysis panel. Shows a plain-English summary, score breakdown, performance vs the market, buy zone signals, and the investment thesis.", position: "left", icon: "details" },
        { target: "[data-coachmark='portfolio-section']", title: "Portfolio Analytics", body: "Diversification, sector allocation, position health, and suggested actions for the simulation portfolio. Scroll down to find it below the main board.", position: "top", icon: "chart" },
      ];

      const INVESTOR_COACHMARK_ICONS = {
        pulse: React.createElement("svg", { width: 20, height: 20, viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round" },
          React.createElement("polyline", { points: "22 12 18 12 15 21 9 3 6 12 2 12" })
        ),
        columns: React.createElement("svg", { width: 20, height: 20, viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round" },
          React.createElement("rect", { x: "3", y: "3", width: "18", height: "18", rx: "2" }),
          React.createElement("line", { x1: "9", y1: "3", x2: "9", y2: "21" }),
          React.createElement("line", { x1: "15", y1: "3", x2: "15", y2: "21" }),
        ),
        list: React.createElement("svg", { width: 20, height: 20, viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round" },
          React.createElement("line", { x1: "8", y1: "6", x2: "21", y2: "6" }),
          React.createElement("line", { x1: "8", y1: "12", x2: "21", y2: "12" }),
          React.createElement("line", { x1: "8", y1: "18", x2: "21", y2: "18" }),
          React.createElement("line", { x1: "3", y1: "6", x2: "3.01", y2: "6" }),
          React.createElement("line", { x1: "3", y1: "12", x2: "3.01", y2: "12" }),
          React.createElement("line", { x1: "3", y1: "18", x2: "3.01", y2: "18" }),
        ),
        details: React.createElement("svg", { width: 20, height: 20, viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round" },
          React.createElement("rect", { x: "3", y: "3", width: "7", height: "7", rx: "1" }),
          React.createElement("rect", { x: "14", y: "3", width: "7", height: "7", rx: "1" }),
          React.createElement("rect", { x: "3", y: "14", width: "7", height: "7", rx: "1" }),
          React.createElement("rect", { x: "14", y: "14", width: "7", height: "7", rx: "1" }),
        ),
        chart: React.createElement("svg", { width: 20, height: 20, viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round" },
          React.createElement("line", { x1: "18", y1: "20", x2: "18", y2: "10" }),
          React.createElement("line", { x1: "12", y1: "20", x2: "12", y2: "4" }),
          React.createElement("line", { x1: "6", y1: "20", x2: "6", y2: "14" }),
        ),
      };

      function InvestorCoachmarks() {
        const STORAGE_KEY = "tt_investor_coachmarks_v1";
        const [step, setStep] = React.useState(-1);
        const [rect, setRect] = React.useState(null);
        const [visible, setVisible] = React.useState(false);
        const rafRef = React.useRef(null);

        React.useEffect(() => {
          try { if (localStorage.getItem(STORAGE_KEY)) return; } catch { return; }
          let cancelled = false;
          const tryStart = () => {
            try { if (!localStorage.getItem("tt_investor_welcomeSeen")) { if (!cancelled) setTimeout(tryStart, 500); return; } } catch { return; }
            if (!cancelled) setTimeout(() => { if (!cancelled) setStep(0); }, 800);
          };
          tryStart();
          return () => { cancelled = true; };
        }, []);

        React.useEffect(() => {
          window.__restartInvestorCoachmarks = () => { setStep(0); };
          return () => { delete window.__restartInvestorCoachmarks; };
        }, []);

        React.useEffect(() => {
          if (step < 0 || step >= INVESTOR_COACHMARK_STEPS.length) { setVisible(false); return; }
          const data = INVESTOR_COACHMARK_STEPS[step];
          const measure = () => {
            const el = document.querySelector(data.target);
            if (!el) { setVisible(false); return; }
            const r = el.getBoundingClientRect();
            setRect({ top: r.top + window.scrollY, left: r.left + window.scrollX, width: r.width, height: r.height });
            setVisible(true);
            el.scrollIntoView({ behavior: "smooth", block: "nearest" });
          };
          measure();
          rafRef.current = requestAnimationFrame(measure);
          const iv = setInterval(measure, 400);
          return () => { cancelAnimationFrame(rafRef.current); clearInterval(iv); };
        }, [step]);

        const skip = () => {
          try { localStorage.setItem(STORAGE_KEY, "skipped"); } catch {}
          setStep(-1);
        };
        const finish = () => {
          try { localStorage.setItem(STORAGE_KEY, String(Date.now())); } catch {}
          setStep(-1);
        };
        const next = () => { if (step < INVESTOR_COACHMARK_STEPS.length - 1) setStep(step + 1); else finish(); };
        const prev = () => { if (step > 0) setStep(step - 1); };

        if (step < 0 || !visible || !rect) return null;

        const data = INVESTOR_COACHMARK_STEPS[step];
        const pad = 8;
        const isLast = step === INVESTOR_COACHMARK_STEPS.length - 1;

        const tooltipStyle = {};
        if (data.position === "bottom") { tooltipStyle.top = rect.top + rect.height + pad + 12; tooltipStyle.left = rect.left + rect.width / 2; tooltipStyle.transform = "translateX(-50%)"; }
        else if (data.position === "top") { tooltipStyle.top = rect.top - pad - 12; tooltipStyle.left = rect.left + rect.width / 2; tooltipStyle.transform = "translate(-50%, -100%)"; }
        else if (data.position === "left") { tooltipStyle.top = rect.top + rect.height / 2; tooltipStyle.left = rect.left - pad - 12; tooltipStyle.transform = "translate(-100%, -50%)"; }
        else { tooltipStyle.top = rect.top + rect.height / 2; tooltipStyle.left = rect.left + rect.width + pad + 12; tooltipStyle.transform = "translateY(-50%)"; }

        return ReactDOM.createPortal(
          React.createElement("div", { className: "fixed inset-0 z-[70]", style: { pointerEvents: "auto" } },
            React.createElement("svg", { className: "absolute inset-0 w-full h-full", style: { pointerEvents: "none" } },
              React.createElement("defs", null,
                React.createElement("mask", { id: "inv-cm-mask" },
                  React.createElement("rect", { x: 0, y: 0, width: "100%", height: "100%", fill: "white" }),
                  React.createElement("rect", { x: rect.left - pad, y: rect.top - pad, width: rect.width + pad * 2, height: rect.height + pad * 2, rx: 12, fill: "black" }),
                ),
              ),
              React.createElement("rect", { x: 0, y: 0, width: "100%", height: "100%", fill: "rgba(0,0,0,0.7)", mask: "url(#inv-cm-mask)" }),
            ),
            React.createElement("div", {
              style: { position: "absolute", left: rect.left - pad, top: rect.top - pad, width: rect.width + pad * 2, height: rect.height + pad * 2, borderRadius: 12, border: "2px solid rgba(34,211,238,0.5)", animation: "coachmark-pulse 2s ease-in-out infinite", pointerEvents: "none" },
            }),
            React.createElement("div", {
              className: "absolute bg-[#0f1117] border border-white/[0.1] rounded-xl shadow-xl p-4 max-w-xs",
              style: { ...tooltipStyle, animation: "coachmark-slide-in 0.3s ease-out", pointerEvents: "auto", zIndex: 71 },
            },
              React.createElement("div", { className: "flex items-center gap-2 mb-2" },
                React.createElement("span", { className: "text-cyan-400" }, INVESTOR_COACHMARK_ICONS[data.icon] || null),
                React.createElement("h3", { className: "text-white font-semibold text-sm" }, data.title),
              ),
              React.createElement("p", { className: "text-[#9ca3af] text-xs leading-relaxed mb-3" }, data.body),
              React.createElement("div", { className: "flex items-center justify-between" },
                React.createElement("div", { className: "flex gap-1" },
                  step > 0 && React.createElement("button", { onClick: prev, className: "text-[10px] text-[#6b7280] hover:text-white px-2 py-1 rounded hover:bg-white/[0.06] transition-colors" }, "\u2190 Back"),
                  React.createElement("button", { onClick: skip, className: "text-[10px] text-[#6b7280] hover:text-white px-2 py-1 rounded hover:bg-white/[0.06] transition-colors" }, "Skip tour"),
                ),
                React.createElement("div", { className: "flex items-center gap-2" },
                  React.createElement("div", { className: "flex gap-1" },
                    ...INVESTOR_COACHMARK_STEPS.map((_, i) => React.createElement("div", { key: i, className: `w-1.5 h-1.5 rounded-full ${i === step ? "bg-cyan-400" : i < step ? "bg-teal-500" : "bg-white/10"}` })),
                  ),
                  React.createElement("button", { onClick: next, className: "text-[10px] text-cyan-400 hover:text-white font-semibold px-2 py-1 rounded bg-cyan-500/10 hover:bg-cyan-500/20 transition-colors" }, isLast ? "Got it" : "Next \u2192"),
                ),
              ),
            ),
          ),
          document.body,
        );
      }

      // â”€â”€â”€ Main App â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      function InvestorDashboard() {
        const [mobileMenuOpen, setMobileMenuOpen] = useState(false);
        const [scores, setScores] = useState(null);
        const [health, setHealth] = useState(null);
        const [portfolio, setPortfolio] = useState(null);
        const [acctSummary, setAcctSummary] = useState(null);
        const [selectedTicker, setSelectedTicker] = useState(null);
        const isEmbedded = new URLSearchParams(window.location.search).get("embedded") === "true";
        const handleSelectTicker = useCallback((ticker) => {
          setSelectedTicker(ticker);
          if (isEmbedded && ticker && window.parent !== window) {
            try { window.parent.postMessage({ type: "tt-select-ticker", ticker: String(ticker).toUpperCase() }, "*"); } catch (_) {}
          }
        }, [isEmbedded]);
        const handleCloseTicker = useCallback(() => {
          setSelectedTicker(null);
          if (isEmbedded && window.parent !== window) {
            try { window.parent.postMessage({ type: "tt-select-ticker", ticker: null }, "*"); } catch (_) {}
          }
        }, [isEmbedded]);
        const [loading, setLoading] = useState(false);
        const [lastComputed, setLastComputed] = useState(null);
        const [sectorFilter, setSectorFilter] = useState(null);
        const [searchQuery, setSearchQuery] = useState("");
        const [showSaved, setShowSaved] = useState(false);

        // Guide & Tour state
        const [showInvestorGuide, setShowInvestorGuide] = useState(() => {
          try { return !localStorage.getItem("tt_investor_welcomeSeen"); } catch { return false; }
        });
        const closeInvestorGuide = useCallback(() => {
          setShowInvestorGuide(false);
          try { localStorage.setItem("tt_investor_welcomeSeen", "true"); } catch {}
        }, []);

        // Record feature usage for Admin "Usage by Feature" (throttled 1h per user per feature)
        useEffect(() => {
          fetch(`${API_BASE}/timed/usage`, { method: "POST", credentials: "include", headers: { "Content-Type": "application/json" }, body: JSON.stringify({ feature: "investor_view" }) }).catch(() => {});
        }, []);

        // â”€â”€ Saved Tickers (per-user, server-backed) â”€â”€
        const [savedTickers, setSavedTickers] = useState(new Set());
        const savedTickersLoadedRef = React.useRef(false);
        useEffect(() => {
          if (savedTickersLoadedRef.current) return;
          savedTickersLoadedRef.current = true;
          (async () => {
            try {
              const res = await fetch(`${API_BASE}/timed/saved`, { cache: "no-store", credentials: "include" });
              const json = await res.json();
              if (json.ok && Array.isArray(json.saved_tickers)) setSavedTickers(new Set(json.saved_tickers));
            } catch (_) {}
          })();
        }, []);

        const toggleSavedTicker = useCallback(async (ticker) => {
          const t = ticker.toUpperCase();
          setSavedTickers(prev => {
            const next = new Set(prev);
            if (next.has(t)) next.delete(t); else next.add(t);
            return next;
          });
          try {
            await fetch(`${API_BASE}/timed/saved/toggle`, { method: "POST", headers: { "Content-Type": "application/json" }, credentials: "include", body: JSON.stringify({ ticker: t }) });
          } catch (_) {}
        }, []);

        const fetchData = useCallback(async () => {
          setLoading(true);
          try {
            const [scoresResp, healthResp, portfolioResp, acctResp] = await Promise.all([
              fetch(`${API_BASE}/timed/investor/scores`).then(r => r.json()).catch(() => null),
              fetch(`${API_BASE}/timed/investor/market-health`).then(r => r.json()).catch(() => null),
              fetch(`${API_BASE}/timed/investor/portfolio`).then(r => r.json()).catch(() => null),
              fetch(`${API_BASE}/timed/account-summary?mode=investor&_t=${Date.now()}`).then(r => r.json()).catch(() => null),
            ]);
            if (scoresResp?.ok) { setScores(scoresResp); setLastComputed(scoresResp.computedAt); }
            if (healthResp?.ok) setHealth(healthResp);
            if (portfolioResp?.ok) setPortfolio(portfolioResp);
            if (acctResp?.ok) setAcctSummary(acctResp);
          } finally { setLoading(false); }
        }, []);

        useEffect(() => {
          fetchData();
          const interval = setInterval(fetchData, 60000);
          return () => clearInterval(interval);
        }, [fetchData]);

        // Price feed: poll /timed/prices every 30s to keep prices fresh
        useEffect(() => {
          if (!scores?.tickers?.length) return;
          let active = true;
          const mergePrices = async () => {
            try {
              const res = await fetch(`${API_BASE}/timed/prices?_t=${Date.now()}`, { cache: "no-store" });
              if (!res.ok || !active) return;
              const json = await res.json();
              if (!json.ok || !json.prices) return;
              const feedTs = json.updated_at || Date.now();
              setScores(prev => {
                if (!prev?.tickers?.length) return prev;
                let changed = false;
                const updated = prev.tickers.map(t => {
                  const pf = json.prices[t.ticker];
                  if (!pf || !(Number(pf.p) > 0)) return t;
                  if (t._live_price === pf.p) return t;
                  changed = true;
                  const feedPc = Number(pf.pc);
                  const feedP = Number(pf.p);
                  const feedPcUsable = Number.isFinite(feedPc) && feedPc > 0 && feedP > 0
                    && (Math.abs(feedPc - feedP) / feedP * 100) > 0.05;
                  const bestPc = feedPcUsable ? feedPc : (t._live_prev_close || t.prev_close || undefined);
                  const feedDc = Number(pf.dc);
                  const feedDp = Number(pf.dp);
                  return {
                    ...t,
                    price: pf.p,
                    _live_price: pf.p,
                    ...(bestPc > 0 ? { _live_prev_close: bestPc, prev_close: bestPc } : {}),
                    ...(Number.isFinite(feedDp) ? { day_change_pct: feedDp, change_pct: feedDp } : {}),
                    ...(Number.isFinite(feedDc) ? { day_change: feedDc, change: feedDc } : {}),
                    ...(Number.isFinite(Number(pf.ahp)) && pf.ahp > 0 ? { _ah_price: pf.ahp } : {}),
                    ...(Number.isFinite(Number(pf.ahdc)) ? { _ah_change: pf.ahdc } : {}),
                    ...(Number.isFinite(Number(pf.ahdp)) ? { _ah_change_pct: pf.ahdp } : {}),
                    _price_updated_at: feedTs,
                  };
                });
                return changed ? { ...prev, tickers: updated } : prev;
              });
            } catch (_) {}
          };
          mergePrices();
          const interval = setInterval(mergePrices, 30000);
          return () => { active = false; clearInterval(interval); };
        }, [scores?.tickers?.length > 0]);

        const allTickers = useMemo(() => scores?.tickers || [], [scores]);

        const selectedData = useMemo(() => {
          if (!selectedTicker || !allTickers.length) return null;
          return allTickers.find(t => t.ticker === selectedTicker);
        }, [selectedTicker, allTickers]);

        // Stage counts
        const stageCounts = useMemo(() => {
          const counts = {};
          for (const t of allTickers) {
            const s = t.stage || "research";
            counts[s] = (counts[s] || 0) + 1;
          }
          return counts;
        }, [allTickers]);

        // Count of action tickers (non-research)
        const actionCount = useMemo(() => {
          return allTickers.filter(t => t.stage && t.stage !== "research").length;
        }, [allTickers]);

        // â”€â”€ Filtered tickers (applies to both viewport AND kanban) â”€â”€
        const filteredTickers = useMemo(() => {
          let list = allTickers;
          if (showSaved) list = list.filter(t => savedTickers.has(t.ticker));
          if (sectorFilter) list = list.filter(t => (t.sector || "Unknown") === sectorFilter);
          if (searchQuery.trim()) {
            const q = searchQuery.toLowerCase();
            list = list.filter(t => t.ticker.toLowerCase().includes(q) || (t.companyName || "").toLowerCase().includes(q));
          }
          return list;
        }, [allTickers, showSaved, savedTickers, sectorFilter, searchQuery]);

        // Sector counts for filter pills
        const sectorCounts = useMemo(() => {
          const counts = {};
          for (const t of allTickers) {
            const s = t.sector || "Unknown";
            counts[s] = (counts[s] || 0) + 1;
          }
          return counts;
        }, [allTickers]);

        const [showFilters, setShowFilters] = useState(false);
        const activeFilterCount = (sectorFilter ? 1 : 0) + (showSaved ? 1 : 0);

        return React.createElement("div", { className: "min-h-screen flex flex-col pb-16" },
          // â•â•â• Nav (hidden when embedded in main dashboard) â•â•â•
          !isEmbedded && React.createElement("nav", { className: "sticky top-0 z-50 border-b border-white/[0.06] shrink-0", style: { background: "rgba(10,10,15,0.95)", backdropFilter: "blur(12px)" } },
            React.createElement("div", { className: "flex items-center justify-between px-4 py-2.5" },
              React.createElement("div", { className: "flex items-center gap-3 md:gap-5 min-w-0" },
                React.createElement("a", { href: "index-react.html", className: "flex items-center gap-2 no-underline shrink-0" },
                  React.createElement("div", { className: "w-[28px] h-[28px] md:w-[32px] md:h-[32px] rounded-[8px] flex items-center justify-center", style: { background: "linear-gradient(135deg, #00c853, #00e676, #69f0ae)" } },
                    React.createElement("svg", { width: 16, height: 16, viewBox: "0 0 24 24", fill: "none", stroke: "white", strokeWidth: "2.5", strokeLinecap: "round", strokeLinejoin: "round" },
                      React.createElement("polyline", { points: "22 7 13.5 15.5 8.5 10.5 2 17" }),
                      React.createElement("polyline", { points: "16 7 22 7 22 13" }),
                    ),
                  ),
                  React.createElement("span", { className: "text-[14px] md:text-[15px] font-bold text-white hidden sm:inline", style: { letterSpacing: "-0.03em" } }, "Timed Trading"),
                ),
                React.createElement("div", { className: "hidden lg:flex items-center gap-0.5" },
                  React.createElement("a", { href: "index-react.html", className: "px-3 py-1 rounded-md text-[13px] text-[#6b7280] hover:text-white hover:bg-white/[0.04] transition-all" }, "Analysis"),
                  React.createElement("a", { href: "simulation-dashboard.html", className: "px-3 py-1 rounded-md text-[13px] text-[#6b7280] hover:text-white hover:bg-white/[0.04] transition-all" }, "Trades"),
                  React.createElement("a", { href: "system-intelligence.html", className: "px-3 py-1 rounded-md text-[13px] text-[#6b7280] hover:text-white hover:bg-white/[0.04] transition-all" }, "System Intelligence"),
                  React.createElement("a", { href: "screener.html", "data-admin-only": "true", className: "px-3 py-1 rounded-md text-[13px] text-[#6b7280] hover:text-white hover:bg-white/[0.04] transition-all" }, "Screener"),
                  React.createElement("a", { href: "ticker-management.html", "data-admin-only": "true", className: "px-3 py-1 rounded-md text-[13px] text-[#6b7280] hover:text-white hover:bg-white/[0.04] transition-all" }, "Tickers"),
                  React.createElement("a", { href: "daily-brief.html", id: "nav-daily-brief", className: "relative px-3 py-1 rounded-md text-[13px] text-[#f59e0b]/80 hover:text-[#f59e0b] hover:bg-[#f59e0b]/[0.06] transition-all font-medium" },
                    "Daily Brief",
                    React.createElement("span", { id: "brief-badge", className: "hidden absolute -top-0.5 -right-0.5 w-2 h-2 rounded-full bg-[#f59e0b]", style: { animation: "pulse-badge 2s ease-in-out infinite" } }),
                  ),
                ),
              ),
              React.createElement("div", { className: "flex items-center gap-1.5 md:gap-2 shrink-0" },
                React.createElement("button", { onClick: () => setShowInvestorGuide(true), className: "hidden md:inline-flex px-2 py-1 rounded-md text-[11px] text-[#6b7280] hover:text-white hover:bg-white/[0.04] transition-all" }, "Guide"),
                React.createElement("button", { onClick: () => { try { localStorage.removeItem("tt_investor_coachmarks_v1"); } catch {} window.__restartInvestorCoachmarks?.(); }, className: "hidden md:inline-flex px-2 py-1 rounded-md text-[11px] text-[#6b7280] hover:text-white hover:bg-white/[0.04] transition-all", title: "Restart the UI tour" }, "Tour"),
                React.createElement("a", { href: "/faq.html", className: "hidden md:inline-flex px-2 py-1 rounded-md text-[11px] text-[#6b7280] hover:text-white hover:bg-white/[0.04] transition-all" }, "FAQ"),
                React.createElement("a", { href: "index-react.html", className: "hidden md:inline-flex px-2 py-1 rounded-md text-[11px] text-[#60a5fa] hover:text-[#93bbfc] hover:bg-[#60a5fa]/[0.06] transition-all font-medium" }, "Ask AI"),
                (typeof window !== "undefined" && (window.TimedAuthHelpers?.getStoredSession()?.role === "admin" || window.TimedAuthHelpers?.getStoredSession()?.tier === "admin")) && React.createElement("a", { href: "admin-clients.html", "data-admin-only": "true", className: "hidden md:inline-flex px-2 py-1 rounded-md text-[11px] text-[#a78bfa]/80 hover:text-[#a78bfa] font-medium" }, "Admin"),
                lastComputed && React.createElement("span", { className: "hidden sm:inline text-[10px] text-[#4b5563]" }, `Scored ${new Date(lastComputed).toLocaleTimeString()}`),
                React.createElement("button", { onClick: fetchData, className: "px-2 md:px-3 py-1 rounded-md text-[11px] md:text-[12px] text-[#6b7280] hover:text-white hover:bg-white/[0.04] border border-white/[0.06] transition-all" }, "Refresh"),
                loading && React.createElement("div", { className: "loading-spinner" }),
                // Mobile hamburger
                React.createElement("button", {
                  onClick: () => setMobileMenuOpen(v => !v),
                  className: "lg:hidden p-1.5 rounded-md text-[#6b7280] hover:text-white hover:bg-white/[0.06] transition-all",
                  "aria-label": "Toggle menu"
                },
                  mobileMenuOpen
                    ? React.createElement("svg", { width: 20, height: 20, viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round" },
                        React.createElement("line", { x1: "18", y1: "6", x2: "6", y2: "18" }),
                        React.createElement("line", { x1: "6", y1: "6", x2: "18", y2: "18" }),
                      )
                    : React.createElement("svg", { width: 20, height: 20, viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round" },
                        React.createElement("line", { x1: "3", y1: "6", x2: "21", y2: "6" }),
                        React.createElement("line", { x1: "3", y1: "12", x2: "21", y2: "12" }),
                        React.createElement("line", { x1: "3", y1: "18", x2: "21", y2: "18" }),
                      ),
                ),
              ),
            ),
            // Mobile dropdown menu
            mobileMenuOpen && React.createElement("div", { className: "lg:hidden border-t border-white/[0.06] px-4 py-2 flex flex-col gap-0.5", style: { background: "rgba(10,10,15,0.98)" } },
              React.createElement("a", { href: "index-react.html", className: "px-3 py-2 rounded-md text-[13px] text-[#9ca3af] hover:text-white hover:bg-white/[0.04] transition-all", onClick: () => setMobileMenuOpen(false) }, "Analysis"),
              React.createElement("a", { href: "simulation-dashboard.html", className: "px-3 py-2 rounded-md text-[13px] text-[#9ca3af] hover:text-white hover:bg-white/[0.04] transition-all", onClick: () => setMobileMenuOpen(false) }, "Trades"),
              React.createElement("a", { href: "system-intelligence.html", className: "px-3 py-2 rounded-md text-[13px] text-[#9ca3af] hover:text-white hover:bg-white/[0.04] transition-all", onClick: () => setMobileMenuOpen(false) }, "System Intelligence"),
              React.createElement("a", { href: "screener.html", "data-admin-only": "true", className: "px-3 py-2 rounded-md text-[13px] text-[#9ca3af] hover:text-white hover:bg-white/[0.04] transition-all", onClick: () => setMobileMenuOpen(false) }, "Screener"),
              React.createElement("a", { href: "ticker-management.html", "data-admin-only": "true", className: "px-3 py-2 rounded-md text-[13px] text-[#9ca3af] hover:text-white hover:bg-white/[0.04] transition-all", onClick: () => setMobileMenuOpen(false) }, "Tickers"),
              React.createElement("a", { href: "daily-brief.html", className: "px-3 py-2 rounded-md text-[13px] text-[#f59e0b]/80 hover:text-[#f59e0b] hover:bg-[#f59e0b]/[0.06] transition-all font-medium", onClick: () => setMobileMenuOpen(false) }, "Daily Brief"),
              React.createElement("div", { className: "border-t border-white/[0.06] mt-1 pt-1 flex items-center gap-2" },
                React.createElement("button", { onClick: () => { setShowInvestorGuide(true); setMobileMenuOpen(false); }, className: "px-3 py-2 rounded-md text-[12px] text-[#6b7280] hover:text-white hover:bg-white/[0.04] transition-all" }, "Guide"),
                React.createElement("button", { onClick: () => { try { localStorage.removeItem("tt_investor_coachmarks_v1"); } catch {} window.__restartInvestorCoachmarks?.(); setMobileMenuOpen(false); }, className: "px-3 py-2 rounded-md text-[12px] text-[#6b7280] hover:text-white hover:bg-white/[0.04] transition-all", title: "Restart tour" }, "Tour"),
                React.createElement("a", { href: "/faq.html", className: "px-3 py-2 rounded-md text-[12px] text-[#6b7280] hover:text-white hover:bg-white/[0.04] transition-all" }, "FAQ"),
                React.createElement("a", { href: "index-react.html", className: "px-3 py-2 rounded-md text-[12px] text-[#60a5fa] hover:text-white hover:bg-white/[0.04] transition-all" }, "Ask AI"),
                React.createElement("a", { href: "mailto:support@timed-trading.com", className: "px-3 py-2 rounded-md text-[12px] text-[#6b7280] hover:text-white hover:bg-white/[0.04] transition-all" }, "Contact"),
              ),
            ),
          ),

          // â•â•â• Search bar + Filters + Saved + Stats (full-width, like Dashboard) â•â•â•
          React.createElement("div", { className: "px-4 pt-3 pb-2 shrink-0" },
            React.createElement("div", { className: "flex flex-wrap items-center justify-between gap-3" },
              // Left: Search + Filters button
              React.createElement("div", { className: "flex items-center gap-2" },
                React.createElement("div", { className: "w-[300px] relative" },
                  React.createElement("svg", { className: "absolute left-3 top-1/2 pointer-events-none", style: { transform: "translateY(-50%)" }, width: 14, height: 14, viewBox: "0 0 24 24", fill: "none", stroke: "#6b7280", strokeWidth: "2.5", strokeLinecap: "round", strokeLinejoin: "round" },
                    React.createElement("circle", { cx: "11", cy: "11", r: "8" }),
                    React.createElement("line", { x1: "21", y1: "21", x2: "16.65", y2: "16.65" }),
                  ),
                  React.createElement("input", {
                    type: "text",
                    placeholder: "Search tickers or filters...",
                    value: searchQuery,
                    onChange: (e) => setSearchQuery(e.target.value),
                    className: "w-full pl-9 pr-3 py-1.5 bg-white/[0.03] border border-white/[0.08] rounded-2xl text-white text-sm placeholder-[#6b7280] focus:border-white/[0.15] focus:outline-none transition-colors",
                  }),
                ),
                // Filters toggle
                React.createElement("button", {
                  onClick: () => setShowFilters(f => !f),
                  className: `flex items-center gap-1.5 px-3 py-1.5 rounded-lg border text-xs font-semibold transition-colors whitespace-nowrap ${
                    showFilters
                      ? "bg-blue-500/20 border-blue-500/40 text-blue-300"
                      : "bg-white/[0.02] border-white/[0.06] text-[#6b7280] hover:text-white hover:bg-[#16224a]"
                  }`,
                  title: "Show/hide filter groups",
                },
                  React.createElement("svg", { width: 13, height: 13, viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round" },
                    React.createElement("line", { x1: "4", y1: "6", x2: "20", y2: "6" }),
                    React.createElement("line", { x1: "4", y1: "12", x2: "20", y2: "12" }),
                    React.createElement("line", { x1: "4", y1: "18", x2: "20", y2: "18" }),
                    React.createElement("circle", { cx: "8", cy: "6", r: "2", fill: "currentColor" }),
                    React.createElement("circle", { cx: "16", cy: "12", r: "2", fill: "currentColor" }),
                    React.createElement("circle", { cx: "10", cy: "18", r: "2", fill: "currentColor" }),
                  ),
                  `Filters ${showFilters ? "â–¾" : "â–¸"}`,
                  activeFilterCount > 0 && React.createElement("span", { className: "ml-0.5 w-4 h-4 rounded-full bg-blue-500 text-white text-[9px] flex items-center justify-center" }, activeFilterCount),
                ),
                // Saved pill
                React.createElement("button", {
                  onClick: () => { setShowSaved(!showSaved); if (!showSaved) setSectorFilter(null); },
                  className: `px-3 py-1.5 rounded-lg border text-xs font-semibold transition-colors ${
                    showSaved
                      ? "bg-amber-500/20 border-amber-500/40 text-amber-300"
                      : "bg-white/[0.02] border-white/[0.06] text-[#6b7280] hover:text-amber-300 hover:bg-amber-500/10"
                  }`,
                  title: `Show only saved tickers (${savedTickers.size} saved)`,
                }, `â­ Saved${savedTickers.size > 0 ? ` (${savedTickers.size})` : ""}`),
              ),
              // Right: Stats pills
              React.createElement("div", { className: "flex gap-1.5 text-[12px] items-center flex-wrap" },
                React.createElement("div", { className: "px-2.5 py-1 rounded-full bg-white/5 border border-white/5" },
                  React.createElement("span", { className: "text-[#6b7280]" }, "Tickers "),
                  React.createElement("span", { className: "font-semibold text-white" }, allTickers.length),
                ),
                (stageCounts.accumulate || 0) > 0 && React.createElement("div", { className: "px-2.5 py-1 rounded-full bg-[#00c853]/8 border border-[#00c853]/15" },
                  React.createElement("span", { className: "text-[#00e676]/80" }, "Accumulate "),
                  React.createElement("span", { className: "font-semibold text-[#00e676]" }, stageCounts.accumulate),
                ),
                (stageCounts.watch || 0) > 0 && React.createElement("div", { className: "px-2.5 py-1 rounded-full bg-amber-500/8 border border-amber-500/15" },
                  React.createElement("span", { className: "text-amber-400/80" }, "Watch "),
                  React.createElement("span", { className: "font-semibold text-amber-400" }, stageCounts.watch),
                ),
                health && React.createElement("div", { className: "px-2.5 py-1 rounded-full bg-white/5 border border-white/5" },
                  React.createElement("span", { className: "text-[#6b7280]" }, "Health "),
                  React.createElement("span", { className: `font-semibold ${health.score >= 70 ? "text-[#00e676]" : health.score >= 45 ? "text-amber-400" : "text-red-400"}` }, health.score),
                ),
              ),
            ),
            // â”€â”€ Filter groups (collapsible): S&P Sectors â”€â”€
            showFilters && React.createElement("div", { className: "mt-2 rounded-xl border border-white/[0.06] bg-white/[0.03] p-3 fade-in" },
              React.createElement("div", { className: "text-[10px] text-[#9ca3af] uppercase tracking-wide font-semibold mb-2" }, "S&P Sectors"),
              React.createElement("div", { className: "flex flex-wrap gap-1.5" },
                React.createElement("button", {
                  onClick: () => setSectorFilter(null),
                  className: `px-2.5 py-1 rounded-lg text-[11px] font-medium transition-all border ${!sectorFilter ? "bg-white/[0.1] border-white/[0.15] text-white" : "border-white/[0.06] text-[#6b7280] hover:text-white hover:bg-white/[0.04]"}`,
                }, `All Sectors (${allTickers.length})`),
                ...Object.entries(sectorCounts)
                  .sort((a, b) => b[1] - a[1])
                  .map(([sec, cnt]) =>
                    React.createElement("button", {
                      key: sec,
                      onClick: () => setSectorFilter(sectorFilter === sec ? null : sec),
                      className: `px-2.5 py-1 rounded-lg text-[11px] font-medium transition-all border ${sectorFilter === sec ? "bg-blue-500/20 border-blue-500/30 text-blue-300" : "border-white/[0.06] text-[#6b7280] hover:text-white hover:bg-white/[0.04]"}`,
                    }, `${sec} (${cnt})`)
                  ),
              ),
            ),
          ),

          // â•â•â• Market Health + Account Summary (compact row) â•â•â•
          React.createElement("div", { className: "px-4 pb-2 shrink-0 space-y-2", "data-coachmark": "market-health" },
            React.createElement(MarketHealthBar, { health, loading }),
            acctSummary && React.createElement("div", { className: "card p-3 fade-in" },
              React.createElement("div", { className: "flex items-center justify-between flex-wrap gap-4 text-[11px]" },
                React.createElement("span", { className: "text-[#6b7280]" }, "Account ",
                  React.createElement("span", { className: "text-white font-bold tabular-nums" }, fmtUsd(acctSummary.accountValue || 0)),
                ),
                React.createElement("span", { className: "text-[#6b7280]" }, "Cash ",
                  React.createElement("span", { className: "text-white font-bold tabular-nums" }, fmtUsd(acctSummary.cash || 0)),
                ),
                React.createElement("span", { className: "text-[#6b7280]", title: "Total market value of all positions the portfolio currently holds" }, "Invested ",
                  React.createElement("span", { className: "text-white font-bold tabular-nums" }, fmtUsd(acctSummary.markToMarket || 0)),
                ),
                React.createElement("span", { className: "text-[#6b7280]", title: "Profit or loss on positions still held â€” not locked in until the position is closed" }, "Open P&L ",
                  React.createElement("span", { className: `font-bold tabular-nums ${(acctSummary.unrealized || 0) >= 0 ? "text-[#00e676]" : "text-red-400"}` },
                    (acctSummary.unrealized >= 0 ? "+" : "") + fmtUsd(acctSummary.unrealized || 0),
                  ),
                ),
                React.createElement("span", { className: "text-[#6b7280]", title: "Profit or loss from positions that have already been sold" }, "Closed P&L ",
                  React.createElement("span", { className: `font-bold tabular-nums ${(acctSummary.totalRealized || 0) >= 0 ? "text-[#00e676]" : "text-red-400"}` },
                    (acctSummary.totalRealized >= 0 ? "+" : "") + fmtUsd(acctSummary.totalRealized || 0),
                  ),
                ),
              ),
            ),
          ),

          // â•â•â• 2-Panel: Viewport | Action Kanban (Right Rail is fixed overlay when ticker selected â€” matches Active Trader) â•â•â•
          React.createElement("div", { className: "investor-3panel flex flex-col lg:flex-row gap-4 px-4 shrink-0" },
            // Left: Viewport (scrollable ticker list â€” hidden on mobile)
            React.createElement("div", { className: "hidden lg:flex w-64 flex-shrink-0 flex-col min-h-0", "data-coachmark": "ticker-list" },
              React.createElement("div", { className: "text-[10px] text-[#4b5563] mb-1 px-1 shrink-0" }, `${filteredTickers.length} ticker${filteredTickers.length !== 1 ? "s" : ""}`),
              React.createElement(TickerListViewport, {
                tickers: filteredTickers,
                onSelect: handleSelectTicker,
                selectedTicker,
                savedTickers,
                toggleSavedTicker,
              }),
            ),

            // Center: Action Kanban (full width when no Right Rail)
            React.createElement("div", { className: `flex-1 flex flex-col min-h-[200px] lg:min-h-0 min-w-0 transition-[margin] duration-300 ${selectedTicker && !isEmbedded ? "lg:mr-[470px]" : ""}`, "data-coachmark": "action-board" },
              React.createElement("div", { className: "mb-2" },
              React.createElement(ActionBoardHeader, { actionCount }),
              React.createElement("div", { className: "text-[9px] text-[#6b7280] mt-0.5", title: "Signals the system monitors to assign lanes" },
                "Signals: Score â€¢ RS Rank â€¢ Accum Zone â€¢ Regime â€¢ Sector",
              ),
            ),
              filteredTickers.length > 0
                ? React.createElement(ActionKanban, { tickers: filteredTickers, onSelect: handleSelectTicker, selectedTicker, savedTickers, toggleSavedTicker })
                : React.createElement("div", { className: "card p-8 text-center text-[#6b7280] flex-1" },
                    React.createElement("div", { className: "text-lg mb-2" }, "No investor data yet"),
                    React.createElement("div", { className: "text-sm" }, "Stock scores are calculated every hour while the market is open. Check back soon."),
                  ),
            ),
          ),

          // â•â•â• Right Rail â€” fixed overlay (when NOT embedded; when embedded, parent shows Right Rail via postMessage) â•â•â•
          selectedTicker && !isEmbedded && React.createElement("div", null,
            React.createElement("div", {
              className: "fixed inset-0 z-30",
              onMouseDown: handleCloseTicker,
            }),
            React.createElement("div", {
              className: "fixed right-0 top-[60px] sm:top-[52px] w-full sm:w-[450px] bottom-[64px] sm:bottom-[56px] bg-[#0b0e11] border-l border-white/[0.04] z-40 slide-in-right shadow-xl overflow-y-auto",
              onMouseDown: (e) => e.stopPropagation(),
              "data-coachmark": "right-rail",
            },
              React.createElement("div", { className: "sticky top-0 z-10 flex items-center justify-between px-4 py-3 border-b border-white/[0.06] bg-[#0b0e11]/95 backdrop-blur-sm" },
                React.createElement("span", { className: "text-sm font-semibold text-white" }, selectedTicker),
                React.createElement("button", {
                  onClick: handleCloseTicker,
                  className: "text-[#6b7280] hover:text-white transition-colors text-lg leading-none w-8 h-8 flex items-center justify-center rounded hover:bg-white/[0.06]",
                  "aria-label": "Close",
                }, "\u2715"),
              ),
              React.createElement("div", { className: "p-4" },
                React.createElement(TickerDeepDive, { ticker: selectedTicker, data: selectedData }),
              ),
            ),
          ),

          // â•â•â• Portfolio Section (always visible below, no excess scrolling) â•â•â•
          portfolio && React.createElement("div", { className: "px-4 py-3 shrink-0", "data-coachmark": "portfolio-section" },
            React.createElement(PortfolioSection, { portfolio }),
          ),

          // â•â•â• Investor Guide Modal â•â•â•
          showInvestorGuide && React.createElement(InvestorWelcomeModal, { onClose: closeInvestorGuide }),

          // â•â•â• Investor Coachmarks Tour â•â•â•
          React.createElement(InvestorCoachmarks, null),
        );
      }

      // â”€â”€â”€ Render â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      const _AuthGate = window.TimedAuthGate;
      const root = ReactDOM.createRoot(document.getElementById("root"));
      root.render(
        _AuthGate
          ? React.createElement(_AuthGate, { apiBase: API_BASE, requiredTier: "free" },
              (user) => React.createElement(InvestorDashboard, { user })
            )
          : React.createElement(InvestorDashboard)
      );
    </script>
    <script>
      (function() {
        fetch("/timed/daily-brief/badge", { cache: "no-store" })
          .then(function(r) { return r.json(); })
          .then(function(d) {
            if (d && d.badge && d.badge.ts) {
              var seen = Number(localStorage.getItem("tt_brief_seen") || 0);
              if (d.badge.ts > seen) {
                var el = document.getElementById("brief-badge");
                if (el) el.classList.remove("hidden");
              }
            }
          })
          .catch(function() {});
      })();
    </script>
    <footer id="legal-footer" style="position:fixed;bottom:0;left:0;right:0;z-index:9999;background:rgba(10,10,15,0.92);backdrop-filter:blur(6px);border-top:1px solid rgba(255,255,255,0.06);padding:6px 16px;text-align:center;font-size:10px;color:#6b7280;line-height:1.4;">
      For informational and educational purposes only. Not investment advice. Past performance does not guarantee future results. All trading involves risk of loss. <a href="/terms.html" style="color:#6b7280;text-decoration:underline;">Full Terms</a> Â· Market data powered by <a href="https://twelvedata.com" target="_blank" rel="noopener" style="color:#6b7280;text-decoration:underline;">Twelve Data</a>
    </footer>
    <script>if(new URLSearchParams(window.location.search).get("embedded")==="true"){document.getElementById("legal-footer").style.display="none";document.body.style.background="transparent";}</script>
    <script>if(new URLSearchParams(window.location.search).get("embedded")==="true"){var f=document.getElementById("legal-footer");if(f)f.style.display="none";}</script>
    <script>if(new URLSearchParams(window.location.search).get("embedded")==="true"){var f=document.getElementById("legal-footer");if(f)f.style.display="none";}</script>
  </body>
</html>

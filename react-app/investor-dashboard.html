<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes" />
    <title>Timed Trading — Investor</title>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cdefs%3E%3ClinearGradient id='g' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' stop-color='%2300c853'/%3E%3Cstop offset='50%25' stop-color='%2300e676'/%3E%3Cstop offset='100%25' stop-color='%2369f0ae'/%3E%3C/linearGradient%3E%3C/defs%3E%3Crect width='24' height='24' rx='5.5' fill='url(%23g)'/%3E%3Cpolyline points='22 7 13.5 15.5 8.5 10.5 2 17' fill='none' stroke='white' stroke-width='2.5' stroke-linecap='round' stroke-linejoin='round'/%3E%3Cpolyline points='16 7 22 7 22 13' fill='none' stroke='white' stroke-width='2.5' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script crossorigin src="https://unpkg.com/prop-types@15/prop-types.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="auth-gate.js?v=20260219a"></script>
    <script src="shared-price-utils.js?v=20260225a"></script>
    <style>
      * { box-sizing: border-box; }
      body { margin: 0; background: #0a0a0f; color: #e5e7eb; font-family: 'Inter', system-ui, sans-serif; }
      .loading-spinner { width: 24px; height: 24px; position: relative; display: inline-block; }
      .loading-spinner::before { content: ""; position: absolute; inset: 0; border-radius: 5px; background: linear-gradient(135deg, rgba(0,200,83,0.15), rgba(0,200,83,0.04)); animation: tt-loader-pulse 1.6s ease-in-out infinite; }
      .loading-spinner::after { content: ""; position: absolute; left: 2px; right: 2px; top: 50%; height: 1.5px; background: linear-gradient(90deg, transparent, #00c853, #00e676, #69f0ae, transparent); background-size: 200% 100%; border-radius: 1px; animation: tt-loader-sweep 1.2s ease-in-out infinite; }
      @keyframes tt-loader-pulse { 0%, 100% { opacity: 0.4; transform: scale(0.92); } 50% { opacity: 1; transform: scale(1); } }
      @keyframes tt-loader-sweep { 0% { background-position: -100% 0; opacity: 0.5; } 50% { opacity: 1; } 100% { background-position: 200% 0; opacity: 0.5; } }
      @keyframes spin { to { transform: rotate(360deg); } }
      @keyframes pulse-badge {
        0%, 100% { opacity: 1; transform: scale(1); }
        50% { opacity: 0.7; transform: scale(1.15); }
      }
      @keyframes fadeIn { from { opacity: 0; transform: translateY(4px); } to { opacity: 1; transform: translateY(0); } }
      .fade-in { animation: fadeIn 0.3s ease-out; }
      .card { background: rgba(255,255,255,0.02); border: 1px solid rgba(255,255,255,0.06); border-radius: 12px; }
      .card-hover:hover { background: rgba(255,255,255,0.04); border-color: rgba(255,255,255,0.1); }
      .stage-badge { padding: 2px 8px; border-radius: 6px; font-size: 11px; font-weight: 600; text-transform: uppercase; }
      .stage-accumulate { background: rgba(16,185,129,0.15); color: #34d399; border: 1px solid rgba(16,185,129,0.3); }
      .stage-core_hold { background: rgba(59,130,246,0.15); color: #60a5fa; border: 1px solid rgba(59,130,246,0.3); }
      .stage-watch { background: rgba(245,158,11,0.15); color: #fbbf24; border: 1px solid rgba(245,158,11,0.3); }
      .stage-reduce { background: rgba(239,68,68,0.15); color: #f87171; border: 1px solid rgba(239,68,68,0.3); }
      .stage-research { background: rgba(139,92,246,0.15); color: #a78bfa; border: 1px solid rgba(139,92,246,0.3); }
      .stage-exited { background: rgba(107,114,128,0.15); color: #9ca3af; border: 1px solid rgba(107,114,128,0.3); }
      /* Admin-only nav links: hidden for non-admin users */
      body:not([data-user-role="admin"]) a[data-admin-only] {
        display: none !important;
      }
      /* Scrollbar styling */
      ::-webkit-scrollbar { width: 4px; }
      ::-webkit-scrollbar-track { background: transparent; }
      ::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.08); border-radius: 4px; }
      ::-webkit-scrollbar-thumb:hover { background: rgba(255,255,255,0.15); }
      /* Responsive 3-panel layout */
      .investor-3panel { min-height: 0; }
      @media (min-width: 1024px) {
        .investor-3panel { height: min(560px, calc(100vh - 300px)); min-height: 320px; }
      }
      /* Slide-in overlay from right (mobile right rail) */
      @keyframes slideInRight {
        from { transform: translateX(100%); opacity: 0; }
        to { transform: translateX(0); opacity: 1; }
      }
      .slide-in-right { animation: slideInRight 0.3s ease-out; }
    </style>
  </head>
  <body>
    <div id="root"></div>

    <script type="text/babel">
      const { useState, useEffect, useCallback, useMemo } = React;
      const API_BASE = "";
      const getDailyChange = window.TimedPriceUtils?.getDailyChange || (() => ({ dayPct: null, dayChg: null }));

      // ─── Helpers ──────────────────────────────────────────────────────
      function fmtPct(n) { return Number.isFinite(n) ? `${n >= 0 ? "+" : ""}${n.toFixed(1)}%` : "—"; }
      function fmtScore(n) { return Number.isFinite(n) ? n.toFixed(0) : "—"; }
      function fmtUsd(n) { return Number.isFinite(n) ? "$" + Math.abs(n).toLocaleString("en-US", { minimumFractionDigits: 2, maximumFractionDigits: 2 }) : "$0.00"; }

      function ScoreBar({ score, max = 100, color = "#3b82f6" }) {
        const pct = Math.max(0, Math.min(100, (score / max) * 100));
        return React.createElement("div", { className: "w-full h-1.5 rounded-full bg-white/[0.06] overflow-hidden" },
          React.createElement("div", { style: { width: `${pct}%`, background: color }, className: "h-full rounded-full transition-all duration-500" })
        );
      }

      function RegimeBadge({ regime }) {
        const colors = { RISK_ON: "text-[#00e676] bg-[#00c853]/10 border-[#00c853]/25", CAUTIOUS: "text-amber-400 bg-amber-500/10 border-amber-500/25", RISK_OFF: "text-red-400 bg-red-500/10 border-red-500/25" };
        const friendlyRegime = { RISK_ON: "Bullish", CAUTIOUS: "Cautious", RISK_OFF: "Bearish" };
        return React.createElement("span", { className: `px-2 py-0.5 rounded-md text-[11px] font-semibold border ${colors[regime] || colors.CAUTIOUS}`, title: regime }, friendlyRegime[regime] || regime);
      }

      function StageBadge({ stage }) {
        return React.createElement("span", { className: `stage-badge stage-${stage}` }, stage.replace("_", " "));
      }

      function TrendArrow({ direction }) {
        if (direction === 1 || direction === "uptrend" || direction === "bullish") {
          return React.createElement("span", { className: "text-[#00e676]", title: "Bullish" }, "▲");
        }
        if (direction === -1 || direction === "downtrend" || direction === "bearish") {
          return React.createElement("span", { className: "text-red-400", title: "Bearish" }, "▼");
        }
        return React.createElement("span", { className: "text-gray-500", title: "Neutral" }, "●");
      }

      const SIGNAL_LABELS = {
        rsi_oversold: "RSI is low (oversold)",
        above_monthly_ema: "Price above monthly trend line",
        monthly_trend_intact: "Monthly trend still healthy",
        weekly_trend_intact: "Weekly trend still healthy",
        above_weekly_ema: "Price above weekly trend line",
        rsi_divergence: "Momentum divergence detected",
        volume_climax: "Unusual selling volume (capitulation)",
        near_support: "Price near a support level",
      };

      const COMPONENT_LABELS = {
        weeklyTrend: { label: "Weekly Trend", tip: "Is the stock trending up or down on a weekly basis?", max: 25 },
        monthlyTrend: { label: "Monthly Trend", tip: "The bigger-picture direction over months", max: 20 },
        relativeStrength: { label: "Strength vs Market", tip: "How this stock performs compared to the S&P 500", max: 20 },
        accumulationSignal: { label: "Buy Zone Signal", tip: "Has the stock pulled back to a favorable entry price?", max: 15 },
        marketHealth: { label: "Market Conditions", tip: "Is the overall market environment supportive?", max: 10 },
        trendDurability: { label: "Trend Durability", tip: "How long and consistently the trend has held", max: 10 },
        sectorContext: { label: "Sector Context", tip: "Is this stock's sector in favor right now?", max: 10 },
      };

      function getScoreLabel(score) {
        if (score >= 70) return "Strong";
        if (score >= 50) return "Mixed";
        return "Weak";
      }

      function getTickerSummary(score, stage) {
        if (score >= 70 && stage === "accumulate") return "Strong setup. The system sees a buying opportunity.";
        if (score >= 70 && stage === "core_hold") return "Strong and steady. The system recommends holding.";
        if (score >= 70) return "Strong signals across the board.";
        if (score >= 50 && stage === "accumulate") return "Moderate setup with a buying opportunity. The system suggests smaller sizing.";
        if (score >= 50 && stage === "watch") return "Mixed signals. The system recommends watching for now.";
        if (score >= 50 && stage === "core_hold") return "Decent health but not firing on all cylinders. Hold and monitor.";
        if (score >= 50) return "Mixed signals — some positives, some caution flags.";
        if (score < 50 && stage === "reduce") return "Weak setup. The system recommends reducing or exiting.";
        if (score < 50 && stage === "watch") return "Weak signals. The system recommends caution.";
        if (score < 50) return "Unfavorable conditions. The system advises caution.";
        return "The system is evaluating this stock.";
      }

      function getRsSummary(rs) {
        if (!rs) return null;
        const pos = [rs.rs1m, rs.rs3m, rs.rs6m].filter(v => Number.isFinite(v) && v > 0).length;
        const neg = [rs.rs1m, rs.rs3m, rs.rs6m].filter(v => Number.isFinite(v) && v < 0).length;
        if (pos === 3) return "Outperforming the market across all timeframes.";
        if (pos >= 2) return "Generally outperforming, with some recent softness.";
        if (neg === 3) return "Underperforming the market. Relative weakness across the board.";
        if (neg >= 2) return "Mostly underperforming. The market is doing better.";
        return "Mixed performance relative to the market.";
      }

      // ─── Market Health Bar ──────────────────────────────────────────
      function MarketHealthBar({ health, loading }) {
        if (!health) return React.createElement("div", { className: "card p-4 mb-4" },
          React.createElement("div", { className: "text-[#6b7280] text-sm" }, loading ? "Loading market health..." : "Market health data hasn't been calculated yet. It updates automatically during market hours.")
        );

        const { score, regime, breadth, components } = health;
        const color = score >= 70 ? "#10b981" : score >= 45 ? "#f59e0b" : "#ef4444";

        return React.createElement("div", { className: "card p-4 mb-4 fade-in" },
          React.createElement("div", { className: "flex items-center justify-between mb-1" },
            React.createElement("div", { className: "flex items-center gap-3" },
              React.createElement("h2", { className: "text-sm font-semibold text-white" }, "Market Health"),
              React.createElement(RegimeBadge, { regime }),
            ),
            React.createElement("div", { className: "flex items-center gap-2" },
              React.createElement("span", { className: "text-2xl font-bold", style: { color } }, score),
              React.createElement("span", { className: "text-[#6b7280] text-xs" }, "/ 100"),
            ),
          ),
          React.createElement("div", { className: "text-[11px] text-[#6b7280] mb-3" }, "How healthy is the overall stock market right now?"),
          React.createElement(ScoreBar, { score, color }),
          React.createElement("div", { className: "grid grid-cols-4 gap-4 mt-3" },
            React.createElement("div", { className: "text-center" },
              React.createElement("div", { className: "text-[10px] text-[#6b7280] uppercase tracking-wide" }, "Participation"),
              React.createElement("div", { className: "text-base font-semibold text-white" }, components?.breadth || 0),
              React.createElement("div", { className: "text-[9px] text-[#4b5563] mt-0.5" }, "Stocks going up vs down"),
            ),
            React.createElement("div", { className: "text-center" },
              React.createElement("div", { className: "text-[10px] text-[#6b7280] uppercase tracking-wide" }, "Market Mode"),
              React.createElement("div", { className: "text-base font-semibold text-white" }, components?.regimeScore || 0),
              React.createElement("div", { className: "text-[9px] text-[#4b5563] mt-0.5" }, "Bullish, cautious, or bearish"),
            ),
            React.createElement("div", { className: "text-center" },
              React.createElement("div", { className: "text-[10px] text-[#6b7280] uppercase tracking-wide" }, "Trend Strength"),
              React.createElement("div", { className: "text-base font-semibold text-white" }, components?.trendMomentum || 0),
              React.createElement("div", { className: "text-[9px] text-[#4b5563] mt-0.5" }, "Trending up or losing steam"),
            ),
            React.createElement("div", { className: "text-center" },
              React.createElement("div", { className: "text-[10px] text-[#6b7280] uppercase tracking-wide" }, "Long-Term"),
              React.createElement("div", { className: "text-base font-semibold text-white" }, breadth?.pctAboveW200 ? `${breadth.pctAboveW200}%` : "—"),
              React.createElement("div", { className: "text-[9px] text-[#4b5563] mt-0.5" }, "Above 200-week average"),
            ),
          ),
        );
      }

      // ─── Action Board Header (inline score key, no toggle) ─────────
      function ActionBoardHeader({ actionCount }) {
        return React.createElement("div", { className: "mb-3 shrink-0" },
          React.createElement("div", { className: "flex items-center justify-between mb-1" },
            React.createElement("h2", { className: "text-sm font-semibold text-white" },
              "Action Board",
              React.createElement("span", { className: "text-[10px] text-[#4b5563] ml-2 font-normal" }, `${actionCount} ticker${actionCount !== 1 ? "s" : ""} need attention`),
            ),
          ),
          React.createElement("div", { className: "flex items-center gap-3 text-[10px] text-[#6b7280]" },
            React.createElement("span", { className: "flex items-center gap-1" },
              React.createElement("span", { className: "w-1.5 h-1.5 rounded-full bg-[#00e676] inline-block" }),
              React.createElement("span", null, "70+ Strong"),
            ),
            React.createElement("span", { className: "flex items-center gap-1" },
              React.createElement("span", { className: "w-1.5 h-1.5 rounded-full bg-amber-400 inline-block" }),
              React.createElement("span", null, "50-69 Mixed"),
            ),
            React.createElement("span", { className: "flex items-center gap-1" },
              React.createElement("span", { className: "w-1.5 h-1.5 rounded-full bg-red-400 inline-block" }),
              React.createElement("span", null, "Under 50 Weak"),
            ),
            React.createElement("span", { className: "text-[#4b5563]" }, "|"),
            React.createElement("span", { className: "text-[9px] text-[#00e676] bg-[#00c853]/10 px-1 rounded", title: "The stock pulled back to a good buy area while its longer-term trend is still healthy" }, "ZONE"),
            React.createElement("span", { className: "text-[#4b5563]" }, "= buy area"),
            React.createElement("span", { className: "text-[9px] text-sky-400 bg-sky-500/10 px-1 rounded", title: "This stock is outperforming the S&P 500 at a new 3-month high" }, "RS HIGH"),
            React.createElement("span", { className: "text-[#4b5563]" }, "= beating the market"),
          ),
        );
      }

      // ─── Action Kanban (Accumulate / Core Hold / Watch / Reduce) ──────
      function ActionKanban({ tickers, onSelect, selectedTicker }) {
        const stages = ["accumulate", "core_hold", "watch", "reduce"];
        const stageLabels = { accumulate: "Accumulate", core_hold: "Core Hold", watch: "Watch", reduce: "Reduce" };
        const stageColors = { accumulate: "#10b981", core_hold: "#3b82f6", watch: "#f59e0b", reduce: "#ef4444" };
        const stageDescriptions = { accumulate: "Consider buying — price is in a favorable zone", core_hold: "Keep holding — trend and strength are solid", watch: "Wait and monitor — signals are mixed", reduce: "Consider selling — showing signs of weakness" };

        const grouped = {};
        for (const s of stages) grouped[s] = [];
        for (const t of tickers) {
          const stage = t.stage || "research";
          if (grouped[stage]) grouped[stage].push(t);
        }

        const hasAny = stages.some(s => grouped[s].length > 0);

        return React.createElement("div", { className: "flex-1 overflow-x-auto overflow-y-hidden" },
          React.createElement("div", { className: "grid grid-cols-4 gap-2 h-full min-w-[640px] lg:min-w-0" },
            ...stages.map(stage =>
              React.createElement("div", { key: stage, className: "flex flex-col min-h-0" },
                React.createElement("div", { className: "flex items-center justify-between mb-2 px-1 shrink-0" },
                  React.createElement("div", { className: "flex items-center gap-1" },
                    React.createElement("span", { className: `stage-badge stage-${stage}` }, stageLabels[stage]),
                    React.createElement("span", { className: "text-[10px] text-[#4b5563]" }, `(${grouped[stage].length})`),
                  ),
                ),
                React.createElement("div", { className: "text-[10px] text-[#4b5563] mb-2 px-1 shrink-0" }, stageDescriptions[stage]),
                React.createElement("div", { className: "flex-1 overflow-y-auto space-y-1 pr-0.5", style: { minHeight: 0 } },
                  ...grouped[stage].map(t =>
                    React.createElement("div", {
                      key: t.ticker,
                      className: `card card-hover p-2 cursor-pointer transition-all ${selectedTicker === t.ticker ? "border-white/20 bg-white/[0.06]" : ""}`,
                      onClick: () => onSelect(t.ticker),
                    },
                      React.createElement("div", { className: "flex items-center justify-between" },
                        React.createElement("span", { className: "text-xs font-semibold text-white" }, t.ticker),
                        React.createElement("span", { className: "flex items-center gap-1.5" },
                          t.price != null && Number.isFinite(t.price) && React.createElement("span", { className: "text-[10px] text-[#9ca3af] tabular-nums" }, `$${t.price.toFixed(2)}`),
                          (() => { const _dc = getDailyChange(t); const _dp = _dc?.dayPct; const _dv = _dc?.dayChg; const _sign = (_dp || 0) >= 0 ? "+" : ""; const _cls = (_dp || 0) >= 0 ? "text-[#00e676]" : "text-red-400"; return (_dp != null && Number.isFinite(_dp)) && React.createElement("span", { className: `text-[10px] font-medium tabular-nums ${_cls}` }, `${_sign}${_dp.toFixed(1)}%`, Number.isFinite(_dv) ? ` (${_sign}$${Math.abs(_dv).toFixed(2)})` : ""); })(),
                        ),
                      ),
                      React.createElement("div", { className: "flex items-center justify-between mt-0.5" },
                        React.createElement("span", { className: `text-[11px] font-semibold tabular-nums ${t.score >= 70 ? "text-[#00e676]" : t.score >= 50 ? "text-amber-400" : "text-red-400"}` }, t.score),
                        React.createElement("span", { className: "flex items-center gap-1" },
                          t.accumZone?.inZone && React.createElement("span", { className: "text-[9px] text-[#00e676] bg-[#00c853]/10 px-1 rounded" }, "ZONE"),
                          t.rs?.rsNewHigh3m && React.createElement("span", { className: "text-[9px] text-sky-400 bg-sky-500/10 px-1 rounded" }, "RS HIGH"),
                        ),
                      ),
                    )
                  ),
                  grouped[stage].length === 0 && React.createElement("div", { className: "text-[10px] text-[#4b5563] text-center py-6 opacity-50" }, "No tickers"),
                ),
              )
            ),
          ),
        );
      }

      // ─── Ticker List (scrollable viewport, no chrome) ────────────────
      function TickerListViewport({ tickers, onSelect, selectedTicker, savedTickers, toggleSavedTicker }) {
        return React.createElement("div", { className: "flex-1 overflow-y-auto space-y-1 pr-0.5 min-h-0" },
          ...tickers.map(t =>
            React.createElement("div", {
              key: t.ticker,
              className: `card card-hover p-2 cursor-pointer transition-all ${selectedTicker === t.ticker ? "border-white/20 bg-white/[0.06]" : ""}`,
              onClick: () => onSelect(t.ticker),
            },
              React.createElement("div", { className: "flex items-center justify-between" },
                React.createElement("div", { className: "flex items-center gap-2 min-w-0" },
                  React.createElement("span", { className: "text-xs font-semibold text-white truncate" }, t.ticker),
                  React.createElement("span", { className: `stage-badge stage-${t.stage || "research"} !text-[8px] !py-0 !px-1` }, (t.stage || "research").replace("_", " ")),
                ),
                React.createElement("div", { className: "flex items-center gap-1.5 shrink-0" },
                  React.createElement("span", { className: `text-[11px] font-semibold tabular-nums ${t.score >= 70 ? "text-[#00e676]" : t.score >= 50 ? "text-amber-400" : "text-red-400"}` }, t.score),
                  React.createElement("button", {
                    onClick: (e) => { e.stopPropagation(); toggleSavedTicker(t.ticker); },
                    className: `text-[13px] hover:scale-110 transition-transform ${savedTickers.has(t.ticker) ? "text-amber-400" : "text-[#4b5563] hover:text-amber-300"}`,
                    title: savedTickers.has(t.ticker) ? "Remove from Saved" : "Add to Saved",
                  }, savedTickers.has(t.ticker) ? "★" : "☆"),
                ),
              ),
              React.createElement("div", { className: "flex items-center justify-between mt-0.5" },
                React.createElement("span", { className: "text-[10px] text-[#6b7280] tabular-nums" },
                  t.price != null && Number.isFinite(t.price)
                    ? `$${t.price.toFixed(2)}`
                    : `RS: ${t.rsRank || "—"}`,
                ),
                React.createElement("span", { className: "flex items-center gap-1" },
                  (() => { const _dc = getDailyChange(t); const _dp = _dc?.dayPct; const _dv = _dc?.dayChg; const _sign = (_dp || 0) >= 0 ? "+" : ""; const _cls = (_dp || 0) >= 0 ? "text-[#00e676]" : "text-red-400"; return (_dp != null && Number.isFinite(_dp)) && React.createElement("span", { className: `text-[9px] tabular-nums font-medium ${_cls}` }, `${_sign}${_dp.toFixed(1)}%`, Number.isFinite(_dv) ? ` (${_sign}$${Math.abs(_dv).toFixed(2)})` : ""); })(),
                  t.accumZone?.inZone && React.createElement("span", { className: "text-[8px] text-[#00e676] bg-[#00c853]/10 px-1 rounded" }, "ZONE"),
                  t.rs?.rsNewHigh3m && React.createElement("span", { className: "text-[8px] text-sky-400 bg-sky-500/10 px-1 rounded" }, "RS HIGH"),
                ),
              ),
              React.createElement("div", { className: "mt-1" },
                React.createElement(ScoreBar, { score: t.score, color: t.score >= 70 ? "#10b981" : t.score >= 50 ? "#f59e0b" : "#ef4444" }),
              ),
            )
          ),
          tickers.length === 0 && React.createElement("div", { className: "text-[11px] text-[#4b5563] text-center py-8" }, "No matching tickers"),
        );
      }

      // ─── Portfolio Section ──────────────────────────────────────────
      function PortfolioSection({ portfolio }) {
        if (!portfolio || !portfolio.positionHealth?.length) {
          return React.createElement("div", { className: "card p-4 mb-4" },
            React.createElement("div", { className: "text-[#6b7280] text-sm" }, "Portfolio analysis will appear here once the portfolio has open positions."),
          );
        }

        const { sectorAllocation, concentrationRisk, diversificationScore, positionHealth, suggestions } = portfolio;

        return React.createElement("div", { className: "card p-4 mb-4 fade-in" },
          React.createElement("h2", { className: "text-sm font-semibold text-white mb-1" }, "Portfolio Analytics"),
          React.createElement("div", { className: "text-[11px] text-[#6b7280] mb-3" }, "How well the simulated portfolio is balanced and where the system sees room for improvement."),
          // Metrics row
          React.createElement("div", { className: "grid grid-cols-3 gap-4 mb-4" },
            React.createElement("div", { className: "card p-3 text-center" },
              React.createElement("div", { className: "text-[10px] text-[#6b7280] uppercase tracking-wide" }, "Diversification"),
              React.createElement("div", { className: `text-xl font-bold ${diversificationScore >= 60 ? "text-[#00e676]" : diversificationScore >= 40 ? "text-amber-400" : "text-red-400"}` }, diversificationScore),
              React.createElement(ScoreBar, { score: diversificationScore, color: diversificationScore >= 60 ? "#10b981" : "#f59e0b" }),
              React.createElement("div", { className: "text-[9px] text-[#4b5563] mt-1" }, "How spread out is the portfolio?"),
            ),
            React.createElement("div", { className: "card p-3 text-center" },
              React.createElement("div", { className: "text-[10px] text-[#6b7280] uppercase tracking-wide" }, "Top-Heavy Risk"),
              React.createElement("div", { className: `text-xl font-bold ${concentrationRisk.rating === "GOOD" ? "text-[#00e676]" : concentrationRisk.rating === "MODERATE" ? "text-amber-400" : "text-red-400"}` }, `${concentrationRisk.top3Pct}%`),
              React.createElement("div", { className: "text-[10px] text-[#6b7280]" }, `Top 3 = ${concentrationRisk.top3Pct}%`),
              React.createElement("div", { className: "text-[9px] text-[#4b5563] mt-0.5" }, concentrationRisk.rating === "GOOD" ? "Healthy — well distributed" : concentrationRisk.rating === "MODERATE" ? "Moderate — could be more spread out" : "High risk — too concentrated"),
            ),
            React.createElement("div", { className: "card p-3 text-center" },
              React.createElement("div", { className: "text-[10px] text-[#6b7280] uppercase tracking-wide" }, "Industries"),
              React.createElement("div", { className: "text-xl font-bold text-white" }, Object.keys(sectorAllocation).length),
              React.createElement("div", { className: "text-[9px] text-[#4b5563] mt-0.5" }, "Different sectors held"),
            ),
          ),
          // Sector allocation
          React.createElement("div", { className: "mb-4" },
            React.createElement("h3", { className: "text-xs font-semibold text-[#9ca3af] mb-1 uppercase tracking-wide" }, "Sector Allocation"),
            React.createElement("div", { className: "text-[10px] text-[#4b5563] mb-2" }, "What percentage of the portfolio is allocated to each industry."),
            React.createElement("div", { className: "space-y-1" },
              ...Object.entries(sectorAllocation)
                .sort((a, b) => b[1].weight - a[1].weight)
                .map(([sector, data]) =>
                  React.createElement("div", { key: sector, className: "flex items-center gap-2" },
                    React.createElement("span", { className: "text-xs text-[#9ca3af] w-28 truncate" }, sector),
                    React.createElement("div", { className: "flex-1", title: data.weight > 30 ? "More than 30% in one sector increases portfolio risk if that industry underperforms" : "" },
                      React.createElement(ScoreBar, { score: data.weight, color: data.weight > 30 ? "#ef4444" : "#3b82f6" }),
                    ),
                    React.createElement("span", { className: "text-xs text-white w-12 text-right" }, `${data.weight}%`),
                  )
                ),
            ),
          ),
          // Position health table
          React.createElement("div", { className: "mb-4" },
            React.createElement("h3", { className: "text-xs font-semibold text-[#9ca3af] mb-1 uppercase tracking-wide" }, "Position Health"),
            React.createElement("div", { className: "text-[10px] text-[#4b5563] mb-2" }, "How each position in the portfolio is performing."),
            React.createElement("div", { className: "overflow-x-auto" },
              React.createElement("table", { className: "w-full text-xs" },
                React.createElement("thead", null,
                  React.createElement("tr", { className: "text-[#6b7280] border-b border-white/[0.06]" },
                    React.createElement("th", { className: "text-left py-1.5 font-medium" }, "Ticker"),
                    React.createElement("th", { className: "text-right py-1.5 font-medium", title: "Profit or loss on this position" }, "Gain/Loss"),
                    React.createElement("th", { className: "text-right py-1.5 font-medium", title: "The system's overall health score for this stock" }, "Health"),
                    React.createElement("th", { className: "text-right py-1.5 font-medium", title: "How this stock performs vs all other tracked stocks relative to the S&P 500" }, "vs Market"),
                    React.createElement("th", { className: "text-right py-1.5 font-medium", title: "What percentage of the portfolio this position represents" }, "Portfolio %"),
                    React.createElement("th", { className: "text-left py-1.5 font-medium pl-2" }, "Sector"),
                  ),
                ),
                React.createElement("tbody", null,
                  ...positionHealth.sort((a, b) => (b.investorScore || 0) - (a.investorScore || 0)).map(ph =>
                    React.createElement("tr", { key: ph.ticker, className: "border-b border-white/[0.03] hover:bg-white/[0.02]" },
                      React.createElement("td", { className: "py-1.5 font-semibold text-white" }, ph.ticker),
                      React.createElement("td", { className: `py-1.5 text-right ${ph.pnlPct >= 0 ? "text-[#00e676]" : "text-red-400"}` }, fmtPct(ph.pnlPct)),
                      React.createElement("td", { className: "py-1.5 text-right text-white" }, ph.investorScore || "—"),
                      React.createElement("td", { className: "py-1.5 text-right text-white" }, ph.rsRank || "—"),
                      React.createElement("td", { className: "py-1.5 text-right text-[#9ca3af]" }, `${ph.weight}%`),
                      React.createElement("td", { className: "py-1.5 pl-2 text-[#6b7280]" }, ph.sector),
                    )
                  ),
                ),
              ),
            ),
          ),
          // Suggestions
          suggestions?.length > 0 && React.createElement("div", null,
            React.createElement("h3", { className: "text-xs font-semibold text-[#9ca3af] mb-1 uppercase tracking-wide" }, "Suggested Actions"),
            React.createElement("div", { className: "text-[10px] text-[#4b5563] mb-2" }, "Steps the system recommends to improve portfolio balance."),
            React.createElement("div", { className: "space-y-1.5" },
              ...suggestions.map((s, i) =>
                React.createElement("div", { key: i, className: `card p-2 text-xs ${s.priority === "high" ? "border-red-500/30" : s.priority === "medium" ? "border-amber-500/30" : "border-white/[0.06]"}` },
                  React.createElement("div", { className: "flex items-center gap-2" },
                    React.createElement("span", { className: `w-1.5 h-1.5 rounded-full ${s.priority === "high" ? "bg-red-400" : s.priority === "medium" ? "bg-amber-400" : "bg-blue-400"}` }),
                    React.createElement("span", { className: "text-[#d1d5db]" }, s.message),
                  ),
                )
              ),
            ),
          ),
        );
      }

      // ─── Ticker Deep Dive (Right Rail) ──────────────────────────────
      function TickerDeepDive({ ticker, data }) {
        if (!ticker || !data) return React.createElement("div", { className: "card p-6 text-center text-[#6b7280] text-sm" },
          React.createElement("div", { className: "text-lg mb-2 opacity-30" }, "←"),
          "Select a ticker to see the full analysis",
        );

        const price = data.price;
        const _dcResult = getDailyChange(data);
        const chgPct = _dcResult?.dayPct ?? null;
        const chgVal = _dcResult?.dayChg ?? null;
        const hasPrice = price != null && Number.isFinite(price);
        const scoreLabel = getScoreLabel(data.score);
        const scoreColor = data.score >= 70 ? "text-[#00e676]" : data.score >= 50 ? "text-amber-400" : "text-red-400";
        const summary = getTickerSummary(data.score, data.stage);

        return React.createElement("div", { className: "card p-5 fade-in space-y-5" },
          // ── Header: ticker + score with context ──
          React.createElement("div", null,
            React.createElement("div", { className: "flex items-center justify-between" },
              React.createElement("div", null,
                React.createElement("h2", { className: "text-lg font-bold text-white" }, ticker),
                data.companyName && React.createElement("div", { className: "text-xs text-[#9ca3af]" }, data.companyName),
                React.createElement("span", { className: "text-[10px] text-[#6b7280]" }, data.sector || "Unknown"),
              ),
              React.createElement("div", { className: "text-right" },
                React.createElement("div", { className: "flex items-baseline gap-1.5 justify-end" },
                  React.createElement("span", { className: `text-2xl font-bold ${scoreColor}` }, data.score),
                  React.createElement("span", { className: `text-xs font-semibold ${scoreColor}` }, scoreLabel),
                ),
                React.createElement("div", { className: "text-[10px] text-[#6b7280]" }, "Investor Score"),
              ),
            ),
            React.createElement("div", { className: "text-[11px] text-[#9ca3af] mt-2 italic leading-relaxed" }, summary),
          ),
          // ── Price + Daily Change ──
          hasPrice && React.createElement("div", { className: "card p-3 flex items-center justify-between" },
            React.createElement("div", null,
              React.createElement("div", { className: "text-[10px] text-[#6b7280] uppercase tracking-wide" }, "Price"),
              React.createElement("div", { className: "text-lg font-bold text-white tabular-nums" }, `$${price.toFixed(2)}`),
            ),
            (chgPct != null && Number.isFinite(chgPct)) && React.createElement("div", { className: "text-right" },
              React.createElement("div", { className: "text-[10px] text-[#6b7280] uppercase tracking-wide" }, "Today"),
              React.createElement("div", { className: `text-lg font-bold tabular-nums ${chgPct >= 0 ? "text-[#00e676]" : "text-red-400"}` }, `${chgPct >= 0 ? "+" : ""}${chgPct.toFixed(2)}%`),
              Number.isFinite(chgVal) && React.createElement("div", { className: `text-[11px] font-medium tabular-nums ${chgVal >= 0 ? "text-[#00e676]/70" : "text-red-400/70"}` }, `${chgVal >= 0 ? "+" : "-"}$${Math.abs(chgVal).toFixed(2)}`),
            ),
            data.prevClose != null && Number.isFinite(data.prevClose) && React.createElement("div", { className: "text-right" },
              React.createElement("div", { className: "text-[10px] text-[#6b7280] uppercase tracking-wide" }, "Yesterday's Close"),
              React.createElement("div", { className: "text-sm font-semibold text-[#9ca3af] tabular-nums" }, `$${data.prevClose.toFixed(2)}`),
            ),
          ),
          // ── Stage + action hint ──
          React.createElement("div", null,
            React.createElement("div", { className: "flex items-center gap-2 mb-1" },
              React.createElement(StageBadge, { stage: data.stage }),
              data.stage === "accumulate" && React.createElement("span", {
                className: "text-[10px] text-[#00e676]/80 bg-[#00c853]/10 px-2 py-0.5 rounded border border-[#00c853]/20",
              }, "Buy signal — add in small portions"),
              data.stage === "watch" && React.createElement("span", {
                className: "text-[10px] text-amber-400/80 bg-amber-500/10 px-2 py-0.5 rounded border border-amber-500/20",
              }, "The system suggests a small starter position"),
              data.stage === "reduce" && React.createElement("span", {
                className: "text-[10px] text-red-400/80 bg-red-500/10 px-2 py-0.5 rounded border border-red-500/20",
              }, "Reduce signal — the system recommends trimming"),
            ),
            data.stageReason && React.createElement("div", { className: "text-[10px] text-[#6b7280]" }, data.stageReason),
          ),
          // ── Score Breakdown with verdict dots ──
          data.components && React.createElement("div", null,
            React.createElement("h3", { className: "text-xs font-semibold text-[#9ca3af] mb-1 uppercase tracking-wide" }, "Score Breakdown"),
            React.createElement("div", { className: "text-[10px] text-[#4b5563] mb-2.5" }, "How the system arrived at this stock's overall score."),
            React.createElement("div", { className: "space-y-2" },
              ...Object.entries(data.components).map(([k, v]) => {
                const meta = COMPONENT_LABELS[k] || { label: k.replace(/([A-Z])/g, " $1").trim(), tip: "", max: 10 };
                const maxVal = meta.max || 10;
                const pct = v / maxVal;
                const dotColor = pct >= 0.6 ? "bg-[#00e676]" : pct >= 0.3 ? "bg-amber-400" : "bg-red-400";
                return React.createElement("div", { key: k, className: "flex items-center gap-2", title: meta.tip },
                  React.createElement("span", { className: `w-1.5 h-1.5 rounded-full ${dotColor} shrink-0` }),
                  React.createElement("span", { className: "text-[11px] text-[#9ca3af] w-28 shrink-0" }, meta.label),
                  React.createElement("div", { className: "flex-1" },
                    React.createElement(ScoreBar, { score: v, max: maxVal, color: "#3b82f6" }),
                  ),
                  React.createElement("span", { className: "text-xs text-white w-6 text-right tabular-nums shrink-0" }, v),
                );
              }),
            ),
          ),
          // ── Performance vs Market ──
          data.rs && React.createElement("div", null,
            React.createElement("h3", { className: "text-xs font-semibold text-[#9ca3af] mb-1 uppercase tracking-wide" }, "Performance vs Market"),
            React.createElement("div", { className: "text-[10px] text-[#4b5563] mb-2.5" }, getRsSummary(data.rs)),
            React.createElement("div", { className: "grid grid-cols-3 gap-2" },
              React.createElement("div", { className: "card p-2.5 text-center" },
                React.createElement("div", { className: "text-[10px] text-[#6b7280]" }, "1 Month"),
                React.createElement("div", { className: `text-sm font-semibold ${data.rs.rs1m >= 0 ? "text-[#00e676]" : "text-red-400"}` }, fmtPct(data.rs.rs1m)),
              ),
              React.createElement("div", { className: "card p-2.5 text-center" },
                React.createElement("div", { className: "text-[10px] text-[#6b7280]" }, "3 Months"),
                React.createElement("div", { className: `text-sm font-semibold ${data.rs.rs3m >= 0 ? "text-[#00e676]" : "text-red-400"}` }, fmtPct(data.rs.rs3m)),
              ),
              React.createElement("div", { className: "card p-2.5 text-center" },
                React.createElement("div", { className: "text-[10px] text-[#6b7280]" }, "6 Months"),
                React.createElement("div", { className: `text-sm font-semibold ${data.rs.rs6m >= 0 ? "text-[#00e676]" : "text-red-400"}` }, fmtPct(data.rs.rs6m)),
              ),
            ),
            React.createElement("div", { className: "mt-2.5" },
              React.createElement("div", { className: "flex items-center justify-between mb-1" },
                React.createElement("span", { className: "text-[11px] text-[#9ca3af]", title: "Relative Strength Rank — compares this stock's performance against every other tracked stock, relative to the S&P 500" },
                  `Outperforms ${data.rsRank}% of all tracked stocks`,
                ),
                React.createElement("div", { className: "flex items-center gap-1" },
                  data.rs.rsNewHigh3m && React.createElement("span", { className: "text-[9px] text-sky-400 bg-sky-500/10 px-1.5 py-0.5 rounded", title: "This stock just hit a new 3-month high in relative strength vs the market" }, "3M Best"),
                  data.rs.rsNewHigh6m && React.createElement("span", { className: "text-[9px] text-[#00e676] bg-[#00c853]/10 px-1.5 py-0.5 rounded", title: "This stock just hit a new 6-month high in relative strength vs the market" }, "6M Best"),
                ),
              ),
              React.createElement(ScoreBar, { score: data.rsRank || 0, color: (data.rsRank || 0) >= 70 ? "#10b981" : (data.rsRank || 0) >= 40 ? "#3b82f6" : "#ef4444" }),
            ),
          ),
          // ── Buy Zone ──
          data.accumZone && React.createElement("div", null,
            React.createElement("h3", { className: "text-xs font-semibold text-[#9ca3af] mb-1 uppercase tracking-wide", title: "Has the stock pulled back to an attractive price while its longer-term trend is still healthy? (Accumulation Zone)" }, "Buy Zone"),
            data.accumZone.inZone
              ? React.createElement("div", { className: "card p-3 border-[#00c853]/30" },
                  React.createElement("div", { className: "flex items-center gap-2 mb-1.5" },
                    React.createElement("span", { className: "w-2 h-2 rounded-full bg-[#00e676] animate-pulse" }),
                    React.createElement("span", { className: "text-xs text-[#00e676] font-semibold" }, "In Buy Zone"),
                    React.createElement("span", { className: "text-[10px] text-[#9ca3af]" }, `${data.accumZone.confidence}% confidence`),
                  ),
                  React.createElement("div", { className: "text-[11px] text-[#9ca3af] leading-relaxed mb-2" }, "The stock dipped to a favorable price without breaking its uptrend — historically a good area to start buying."),
                  React.createElement("div", { className: "text-[10px] text-[#6b7280] mb-1" }, `${data.accumZone.signals?.length || 0} of 5 signals active:`),
                  React.createElement("div", { className: "flex flex-wrap gap-1" },
                    ...data.accumZone.signals.map((s, i) =>
                      React.createElement("span", { key: i, className: "text-[9px] px-1.5 py-0.5 rounded bg-white/[0.04] text-[#9ca3af]" }, SIGNAL_LABELS[s] || s.replace(/_/g, " "))
                    ),
                  ),
                )
              : React.createElement("div", { className: "text-[11px] text-[#6b7280] leading-relaxed" }, "Not in a buy zone right now. The stock hasn't pulled back to a favorable entry point yet."),
          ),
          // ── Thesis ──
          data.thesis && React.createElement("div", null,
            React.createElement("h3", { className: "text-xs font-semibold text-[#9ca3af] mb-1 uppercase tracking-wide" }, "Investment Thesis"),
            React.createElement("div", { className: "text-[10px] text-[#4b5563] mb-2" }, "Why the system is tracking this stock and what would change the outlook."),
            React.createElement("div", { className: "text-xs text-[#d1d5db] leading-relaxed mb-2" }, data.thesis),
            data.thesisInvalidation?.length > 0 && React.createElement("div", null,
              React.createElement("div", { className: "text-[10px] text-[#6b7280] mb-1" }, "What would change this view:"),
              ...data.thesisInvalidation.map((inv, i) =>
                React.createElement("div", { key: i, className: "text-[11px] text-red-400/80 pl-2" }, `• ${inv}`)
              ),
            ),
          ),
        );
      }

      // ─── Main App ──────────────────────────────────────────────────
      function InvestorDashboard() {
        const [mobileMenuOpen, setMobileMenuOpen] = useState(false);
        const [scores, setScores] = useState(null);
        const [health, setHealth] = useState(null);
        const [portfolio, setPortfolio] = useState(null);
        const [acctSummary, setAcctSummary] = useState(null);
        const [selectedTicker, setSelectedTicker] = useState(null);
        const [loading, setLoading] = useState(false);
        const [lastComputed, setLastComputed] = useState(null);
        const [sectorFilter, setSectorFilter] = useState(null);
        const [searchQuery, setSearchQuery] = useState("");
        const [showSaved, setShowSaved] = useState(false);

        // Record feature usage for Admin "Usage by Feature" (throttled 1h per user per feature)
        useEffect(() => {
          fetch(`${API_BASE}/timed/usage`, { method: "POST", credentials: "include", headers: { "Content-Type": "application/json" }, body: JSON.stringify({ feature: "investor_view" }) }).catch(() => {});
        }, []);

        // ── Saved Tickers (per-user, server-backed) ──
        const [savedTickers, setSavedTickers] = useState(new Set());
        const savedTickersLoadedRef = React.useRef(false);
        useEffect(() => {
          if (savedTickersLoadedRef.current) return;
          savedTickersLoadedRef.current = true;
          (async () => {
            try {
              const res = await fetch(`${API_BASE}/timed/saved`, { cache: "no-store", credentials: "include" });
              const json = await res.json();
              if (json.ok && Array.isArray(json.saved_tickers)) setSavedTickers(new Set(json.saved_tickers));
            } catch (_) {}
          })();
        }, []);

        const toggleSavedTicker = useCallback(async (ticker) => {
          const t = ticker.toUpperCase();
          setSavedTickers(prev => {
            const next = new Set(prev);
            if (next.has(t)) next.delete(t); else next.add(t);
            return next;
          });
          try {
            await fetch(`${API_BASE}/timed/saved/toggle`, { method: "POST", headers: { "Content-Type": "application/json" }, credentials: "include", body: JSON.stringify({ ticker: t }) });
          } catch (_) {}
        }, []);

        const fetchData = useCallback(async () => {
          setLoading(true);
          try {
            const [scoresResp, healthResp, portfolioResp, acctResp] = await Promise.all([
              fetch(`${API_BASE}/timed/investor/scores`).then(r => r.json()).catch(() => null),
              fetch(`${API_BASE}/timed/investor/market-health`).then(r => r.json()).catch(() => null),
              fetch(`${API_BASE}/timed/investor/portfolio`).then(r => r.json()).catch(() => null),
              fetch(`${API_BASE}/timed/account-summary?mode=investor&_t=${Date.now()}`).then(r => r.json()).catch(() => null),
            ]);
            if (scoresResp?.ok) { setScores(scoresResp); setLastComputed(scoresResp.computedAt); }
            if (healthResp?.ok) setHealth(healthResp);
            if (portfolioResp?.ok) setPortfolio(portfolioResp);
            if (acctResp?.ok) setAcctSummary(acctResp);
          } finally { setLoading(false); }
        }, []);

        useEffect(() => {
          fetchData();
          const interval = setInterval(fetchData, 60000);
          return () => clearInterval(interval);
        }, [fetchData]);

        // Price feed: poll /timed/prices every 30s to keep prices fresh
        useEffect(() => {
          if (!scores?.tickers?.length) return;
          let active = true;
          const mergePrices = async () => {
            try {
              const res = await fetch(`${API_BASE}/timed/prices?_t=${Date.now()}`, { cache: "no-store" });
              if (!res.ok || !active) return;
              const json = await res.json();
              if (!json.ok || !json.prices) return;
              const feedTs = json.updated_at || Date.now();
              setScores(prev => {
                if (!prev?.tickers?.length) return prev;
                let changed = false;
                const updated = prev.tickers.map(t => {
                  const pf = json.prices[t.ticker];
                  if (!pf || !(Number(pf.p) > 0)) return t;
                  if (t._live_price === pf.p) return t;
                  changed = true;
                  const feedPc = Number(pf.pc);
                  const feedP = Number(pf.p);
                  const feedPcUsable = Number.isFinite(feedPc) && feedPc > 0 && feedP > 0
                    && (Math.abs(feedPc - feedP) / feedP * 100) > 0.05;
                  const bestPc = feedPcUsable ? feedPc : (t._live_prev_close || t.prev_close || undefined);
                  const feedDc = Number(pf.dc);
                  const feedDp = Number(pf.dp);
                  return {
                    ...t,
                    price: pf.p,
                    _live_price: pf.p,
                    ...(bestPc > 0 ? { _live_prev_close: bestPc, prev_close: bestPc } : {}),
                    ...(Number.isFinite(feedDp) ? { day_change_pct: feedDp, change_pct: feedDp } : {}),
                    ...(Number.isFinite(feedDc) ? { day_change: feedDc, change: feedDc } : {}),
                    ...(Number.isFinite(Number(pf.ahp)) && pf.ahp > 0 ? { _ah_price: pf.ahp } : {}),
                    ...(Number.isFinite(Number(pf.ahdc)) ? { _ah_change: pf.ahdc } : {}),
                    ...(Number.isFinite(Number(pf.ahdp)) ? { _ah_change_pct: pf.ahdp } : {}),
                    _price_updated_at: feedTs,
                  };
                });
                return changed ? { ...prev, tickers: updated } : prev;
              });
            } catch (_) {}
          };
          mergePrices();
          const interval = setInterval(mergePrices, 30000);
          return () => { active = false; clearInterval(interval); };
        }, [scores?.tickers?.length > 0]);

        const allTickers = useMemo(() => scores?.tickers || [], [scores]);

        const selectedData = useMemo(() => {
          if (!selectedTicker || !allTickers.length) return null;
          return allTickers.find(t => t.ticker === selectedTicker);
        }, [selectedTicker, allTickers]);

        // Stage counts
        const stageCounts = useMemo(() => {
          const counts = {};
          for (const t of allTickers) {
            const s = t.stage || "research";
            counts[s] = (counts[s] || 0) + 1;
          }
          return counts;
        }, [allTickers]);

        // Count of action tickers (non-research)
        const actionCount = useMemo(() => {
          return allTickers.filter(t => t.stage && t.stage !== "research").length;
        }, [allTickers]);

        // ── Filtered tickers (applies to both viewport AND kanban) ──
        const filteredTickers = useMemo(() => {
          let list = allTickers;
          if (showSaved) list = list.filter(t => savedTickers.has(t.ticker));
          if (sectorFilter) list = list.filter(t => (t.sector || "Unknown") === sectorFilter);
          if (searchQuery.trim()) {
            const q = searchQuery.toLowerCase();
            list = list.filter(t => t.ticker.toLowerCase().includes(q) || (t.companyName || "").toLowerCase().includes(q));
          }
          return list;
        }, [allTickers, showSaved, savedTickers, sectorFilter, searchQuery]);

        // Sector counts for filter pills
        const sectorCounts = useMemo(() => {
          const counts = {};
          for (const t of allTickers) {
            const s = t.sector || "Unknown";
            counts[s] = (counts[s] || 0) + 1;
          }
          return counts;
        }, [allTickers]);

        const [showFilters, setShowFilters] = useState(false);
        const activeFilterCount = (sectorFilter ? 1 : 0) + (showSaved ? 1 : 0);

        return React.createElement("div", { className: "min-h-screen flex flex-col" },
          // ═══ Nav ═══
          React.createElement("nav", { className: "sticky top-0 z-50 border-b border-white/[0.06] shrink-0", style: { background: "rgba(10,10,15,0.95)", backdropFilter: "blur(12px)" } },
            React.createElement("div", { className: "flex items-center justify-between px-4 py-2.5" },
              React.createElement("div", { className: "flex items-center gap-3 md:gap-5 min-w-0" },
                React.createElement("a", { href: "index-react.html", className: "flex items-center gap-2 no-underline shrink-0" },
                  React.createElement("div", { className: "w-[28px] h-[28px] md:w-[32px] md:h-[32px] rounded-[8px] flex items-center justify-center", style: { background: "linear-gradient(135deg, #00c853, #00e676, #69f0ae)" } },
                    React.createElement("svg", { width: 16, height: 16, viewBox: "0 0 24 24", fill: "none", stroke: "white", strokeWidth: "2.5", strokeLinecap: "round", strokeLinejoin: "round" },
                      React.createElement("polyline", { points: "22 7 13.5 15.5 8.5 10.5 2 17" }),
                      React.createElement("polyline", { points: "16 7 22 7 22 13" }),
                    ),
                  ),
                  React.createElement("span", { className: "text-[14px] md:text-[15px] font-bold text-white hidden sm:inline", style: { letterSpacing: "-0.03em" } }, "Timed Trading"),
                ),
                React.createElement("div", { className: "hidden lg:flex items-center gap-0.5" },
                  React.createElement("a", { href: "index-react.html", className: "px-3 py-1 rounded-md text-[13px] text-[#6b7280] hover:text-white hover:bg-white/[0.04] transition-all" }, "Active Trader"),
                  React.createElement("a", { href: "investor-dashboard.html", className: "px-3 py-1 rounded-md text-[13px] text-white bg-white/[0.07] font-medium" }, "Investor"),
                  React.createElement("a", { href: "simulation-dashboard.html", className: "px-3 py-1 rounded-md text-[13px] text-[#6b7280] hover:text-white hover:bg-white/[0.04] transition-all" }, "Trades"),
                  React.createElement("a", { href: "system-intelligence.html", className: "px-3 py-1 rounded-md text-[13px] text-[#6b7280] hover:text-white hover:bg-white/[0.04] transition-all" }, "System Intelligence"),
                  React.createElement("a", { href: "screener.html", "data-admin-only": "true", className: "px-3 py-1 rounded-md text-[13px] text-[#6b7280] hover:text-white hover:bg-white/[0.04] transition-all" }, "Screener"),
                  React.createElement("a", { href: "ticker-management.html", "data-admin-only": "true", className: "px-3 py-1 rounded-md text-[13px] text-[#6b7280] hover:text-white hover:bg-white/[0.04] transition-all" }, "Tickers"),
                  React.createElement("a", { href: "daily-brief.html", id: "nav-daily-brief", className: "relative px-3 py-1 rounded-md text-[13px] text-[#f59e0b]/80 hover:text-[#f59e0b] hover:bg-[#f59e0b]/[0.06] transition-all font-medium" },
                    "Daily Brief",
                    React.createElement("span", { id: "brief-badge", className: "hidden absolute -top-0.5 -right-0.5 w-2 h-2 rounded-full bg-[#f59e0b]", style: { animation: "pulse-badge 2s ease-in-out infinite" } }),
                  ),
                ),
              ),
              React.createElement("div", { className: "flex items-center gap-1.5 md:gap-2 shrink-0" },
                React.createElement("a", { href: "/faq.html", className: "hidden md:inline-flex px-2 py-1 rounded-md text-[11px] text-[#6b7280] hover:text-white hover:bg-white/[0.04] transition-all" }, "Guide"),
                React.createElement("a", { href: "/faq.html", className: "hidden md:inline-flex px-2 py-1 rounded-md text-[11px] text-[#6b7280] hover:text-white hover:bg-white/[0.04] transition-all" }, "FAQ"),
                React.createElement("a", { href: "index-react.html", className: "hidden md:inline-flex px-2 py-1 rounded-md text-[11px] text-[#60a5fa] hover:text-[#93bbfc] hover:bg-[#60a5fa]/[0.06] transition-all font-medium" }, "Ask AI"),
                (typeof window !== "undefined" && (window.TimedAuthHelpers?.getStoredSession()?.role === "admin" || window.TimedAuthHelpers?.getStoredSession()?.tier === "admin")) && React.createElement("a", { href: "admin-clients.html", "data-admin-only": "true", className: "hidden md:inline-flex px-2 py-1 rounded-md text-[11px] text-[#a78bfa]/80 hover:text-[#a78bfa] font-medium" }, "Admin"),
                lastComputed && React.createElement("span", { className: "hidden sm:inline text-[10px] text-[#4b5563]" }, `Scored ${new Date(lastComputed).toLocaleTimeString()}`),
                React.createElement("button", { onClick: fetchData, className: "px-2 md:px-3 py-1 rounded-md text-[11px] md:text-[12px] text-[#6b7280] hover:text-white hover:bg-white/[0.04] border border-white/[0.06] transition-all" }, "Refresh"),
                loading && React.createElement("div", { className: "loading-spinner" }),
                // Mobile hamburger
                React.createElement("button", {
                  onClick: () => setMobileMenuOpen(v => !v),
                  className: "lg:hidden p-1.5 rounded-md text-[#6b7280] hover:text-white hover:bg-white/[0.06] transition-all",
                  "aria-label": "Toggle menu"
                },
                  mobileMenuOpen
                    ? React.createElement("svg", { width: 20, height: 20, viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round" },
                        React.createElement("line", { x1: "18", y1: "6", x2: "6", y2: "18" }),
                        React.createElement("line", { x1: "6", y1: "6", x2: "18", y2: "18" }),
                      )
                    : React.createElement("svg", { width: 20, height: 20, viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round" },
                        React.createElement("line", { x1: "3", y1: "6", x2: "21", y2: "6" }),
                        React.createElement("line", { x1: "3", y1: "12", x2: "21", y2: "12" }),
                        React.createElement("line", { x1: "3", y1: "18", x2: "21", y2: "18" }),
                      ),
                ),
              ),
            ),
            // Mobile dropdown menu
            mobileMenuOpen && React.createElement("div", { className: "lg:hidden border-t border-white/[0.06] px-4 py-2 flex flex-col gap-0.5", style: { background: "rgba(10,10,15,0.98)" } },
              React.createElement("a", { href: "index-react.html", className: "px-3 py-2 rounded-md text-[13px] text-[#9ca3af] hover:text-white hover:bg-white/[0.04] transition-all", onClick: () => setMobileMenuOpen(false) }, "Active Trader"),
              React.createElement("a", { href: "investor-dashboard.html", className: "px-3 py-2 rounded-md text-[13px] text-white bg-white/[0.07] font-medium", onClick: () => setMobileMenuOpen(false) }, "Investor"),
              React.createElement("a", { href: "simulation-dashboard.html", className: "px-3 py-2 rounded-md text-[13px] text-[#9ca3af] hover:text-white hover:bg-white/[0.04] transition-all", onClick: () => setMobileMenuOpen(false) }, "Trades"),
              React.createElement("a", { href: "system-intelligence.html", className: "px-3 py-2 rounded-md text-[13px] text-[#9ca3af] hover:text-white hover:bg-white/[0.04] transition-all", onClick: () => setMobileMenuOpen(false) }, "System Intelligence"),
              React.createElement("a", { href: "screener.html", "data-admin-only": "true", className: "px-3 py-2 rounded-md text-[13px] text-[#9ca3af] hover:text-white hover:bg-white/[0.04] transition-all", onClick: () => setMobileMenuOpen(false) }, "Screener"),
              React.createElement("a", { href: "ticker-management.html", "data-admin-only": "true", className: "px-3 py-2 rounded-md text-[13px] text-[#9ca3af] hover:text-white hover:bg-white/[0.04] transition-all", onClick: () => setMobileMenuOpen(false) }, "Tickers"),
              React.createElement("a", { href: "daily-brief.html", className: "px-3 py-2 rounded-md text-[13px] text-[#f59e0b]/80 hover:text-[#f59e0b] hover:bg-[#f59e0b]/[0.06] transition-all font-medium", onClick: () => setMobileMenuOpen(false) }, "Daily Brief"),
              React.createElement("div", { className: "border-t border-white/[0.06] mt-1 pt-1 flex items-center gap-2" },
                React.createElement("a", { href: "/faq.html", className: "px-3 py-2 rounded-md text-[12px] text-[#6b7280] hover:text-white hover:bg-white/[0.04] transition-all" }, "Guide"),
                React.createElement("a", { href: "/faq.html", className: "px-3 py-2 rounded-md text-[12px] text-[#6b7280] hover:text-white hover:bg-white/[0.04] transition-all" }, "FAQ"),
                React.createElement("a", { href: "index-react.html", className: "px-3 py-2 rounded-md text-[12px] text-[#60a5fa] hover:text-white hover:bg-white/[0.04] transition-all" }, "Ask AI"),
                React.createElement("a", { href: "mailto:support@timed-trading.com", className: "px-3 py-2 rounded-md text-[12px] text-[#6b7280] hover:text-white hover:bg-white/[0.04] transition-all" }, "Contact"),
              ),
            ),
          ),

          // ═══ Search bar + Filters + Saved + Stats (full-width, like Dashboard) ═══
          React.createElement("div", { className: "px-4 pt-3 pb-2 shrink-0" },
            React.createElement("div", { className: "flex flex-wrap items-center justify-between gap-3" },
              // Left: Search + Filters button
              React.createElement("div", { className: "flex items-center gap-2" },
                React.createElement("div", { className: "w-[300px] relative" },
                  React.createElement("svg", { className: "absolute left-3 top-1/2 pointer-events-none", style: { transform: "translateY(-50%)" }, width: 14, height: 14, viewBox: "0 0 24 24", fill: "none", stroke: "#6b7280", strokeWidth: "2.5", strokeLinecap: "round", strokeLinejoin: "round" },
                    React.createElement("circle", { cx: "11", cy: "11", r: "8" }),
                    React.createElement("line", { x1: "21", y1: "21", x2: "16.65", y2: "16.65" }),
                  ),
                  React.createElement("input", {
                    type: "text",
                    placeholder: "Search tickers or filters...",
                    value: searchQuery,
                    onChange: (e) => setSearchQuery(e.target.value),
                    className: "w-full pl-9 pr-3 py-1.5 bg-white/[0.03] border border-white/[0.08] rounded-2xl text-white text-sm placeholder-[#6b7280] focus:border-white/[0.15] focus:outline-none transition-colors",
                  }),
                ),
                // Filters toggle
                React.createElement("button", {
                  onClick: () => setShowFilters(f => !f),
                  className: `flex items-center gap-1.5 px-3 py-1.5 rounded-lg border text-xs font-semibold transition-colors whitespace-nowrap ${
                    showFilters
                      ? "bg-blue-500/20 border-blue-500/40 text-blue-300"
                      : "bg-white/[0.02] border-white/[0.06] text-[#6b7280] hover:text-white hover:bg-[#16224a]"
                  }`,
                  title: "Show/hide filter groups",
                },
                  React.createElement("svg", { width: 13, height: 13, viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round" },
                    React.createElement("line", { x1: "4", y1: "6", x2: "20", y2: "6" }),
                    React.createElement("line", { x1: "4", y1: "12", x2: "20", y2: "12" }),
                    React.createElement("line", { x1: "4", y1: "18", x2: "20", y2: "18" }),
                    React.createElement("circle", { cx: "8", cy: "6", r: "2", fill: "currentColor" }),
                    React.createElement("circle", { cx: "16", cy: "12", r: "2", fill: "currentColor" }),
                    React.createElement("circle", { cx: "10", cy: "18", r: "2", fill: "currentColor" }),
                  ),
                  `Filters ${showFilters ? "▾" : "▸"}`,
                  activeFilterCount > 0 && React.createElement("span", { className: "ml-0.5 w-4 h-4 rounded-full bg-blue-500 text-white text-[9px] flex items-center justify-center" }, activeFilterCount),
                ),
                // Saved pill
                React.createElement("button", {
                  onClick: () => { setShowSaved(!showSaved); if (!showSaved) setSectorFilter(null); },
                  className: `px-3 py-1.5 rounded-lg border text-xs font-semibold transition-colors ${
                    showSaved
                      ? "bg-amber-500/20 border-amber-500/40 text-amber-300"
                      : "bg-white/[0.02] border-white/[0.06] text-[#6b7280] hover:text-amber-300 hover:bg-amber-500/10"
                  }`,
                  title: `Show only saved tickers (${savedTickers.size} saved)`,
                }, `⭐ Saved${savedTickers.size > 0 ? ` (${savedTickers.size})` : ""}`),
              ),
              // Right: Stats pills
              React.createElement("div", { className: "flex gap-1.5 text-[12px] items-center flex-wrap" },
                React.createElement("div", { className: "px-2.5 py-1 rounded-full bg-white/5 border border-white/5" },
                  React.createElement("span", { className: "text-[#6b7280]" }, "Tickers "),
                  React.createElement("span", { className: "font-semibold text-white" }, allTickers.length),
                ),
                (stageCounts.accumulate || 0) > 0 && React.createElement("div", { className: "px-2.5 py-1 rounded-full bg-[#00c853]/8 border border-[#00c853]/15" },
                  React.createElement("span", { className: "text-[#00e676]/80" }, "Accumulate "),
                  React.createElement("span", { className: "font-semibold text-[#00e676]" }, stageCounts.accumulate),
                ),
                (stageCounts.watch || 0) > 0 && React.createElement("div", { className: "px-2.5 py-1 rounded-full bg-amber-500/8 border border-amber-500/15" },
                  React.createElement("span", { className: "text-amber-400/80" }, "Watch "),
                  React.createElement("span", { className: "font-semibold text-amber-400" }, stageCounts.watch),
                ),
                health && React.createElement("div", { className: "px-2.5 py-1 rounded-full bg-white/5 border border-white/5" },
                  React.createElement("span", { className: "text-[#6b7280]" }, "Health "),
                  React.createElement("span", { className: `font-semibold ${health.score >= 70 ? "text-[#00e676]" : health.score >= 45 ? "text-amber-400" : "text-red-400"}` }, health.score),
                ),
              ),
            ),
            // ── Filter groups (collapsible): S&P Sectors ──
            showFilters && React.createElement("div", { className: "mt-2 rounded-xl border border-white/[0.06] bg-white/[0.03] p-3 fade-in" },
              React.createElement("div", { className: "text-[10px] text-[#9ca3af] uppercase tracking-wide font-semibold mb-2" }, "S&P Sectors"),
              React.createElement("div", { className: "flex flex-wrap gap-1.5" },
                React.createElement("button", {
                  onClick: () => setSectorFilter(null),
                  className: `px-2.5 py-1 rounded-lg text-[11px] font-medium transition-all border ${!sectorFilter ? "bg-white/[0.1] border-white/[0.15] text-white" : "border-white/[0.06] text-[#6b7280] hover:text-white hover:bg-white/[0.04]"}`,
                }, `All Sectors (${allTickers.length})`),
                ...Object.entries(sectorCounts)
                  .sort((a, b) => b[1] - a[1])
                  .map(([sec, cnt]) =>
                    React.createElement("button", {
                      key: sec,
                      onClick: () => setSectorFilter(sectorFilter === sec ? null : sec),
                      className: `px-2.5 py-1 rounded-lg text-[11px] font-medium transition-all border ${sectorFilter === sec ? "bg-blue-500/20 border-blue-500/30 text-blue-300" : "border-white/[0.06] text-[#6b7280] hover:text-white hover:bg-white/[0.04]"}`,
                    }, `${sec} (${cnt})`)
                  ),
              ),
            ),
          ),

          // ═══ Market Health + Account Summary (compact row) ═══
          React.createElement("div", { className: "px-4 pb-2 shrink-0 space-y-2" },
            React.createElement(MarketHealthBar, { health, loading }),
            acctSummary && React.createElement("div", { className: "card p-3 fade-in" },
              React.createElement("div", { className: "flex items-center justify-between flex-wrap gap-4 text-[11px]" },
                React.createElement("span", { className: "text-[#6b7280]" }, "Account ",
                  React.createElement("span", { className: "text-white font-bold tabular-nums" }, fmtUsd(acctSummary.accountValue || 0)),
                ),
                React.createElement("span", { className: "text-[#6b7280]" }, "Cash ",
                  React.createElement("span", { className: "text-white font-bold tabular-nums" }, fmtUsd(acctSummary.cash || 0)),
                ),
                React.createElement("span", { className: "text-[#6b7280]", title: "Total market value of all positions the portfolio currently holds" }, "Invested ",
                  React.createElement("span", { className: "text-white font-bold tabular-nums" }, fmtUsd(acctSummary.markToMarket || 0)),
                ),
                React.createElement("span", { className: "text-[#6b7280]", title: "Profit or loss on positions still held — not locked in until the position is closed" }, "Open P&L ",
                  React.createElement("span", { className: `font-bold tabular-nums ${(acctSummary.unrealized || 0) >= 0 ? "text-[#00e676]" : "text-red-400"}` },
                    (acctSummary.unrealized >= 0 ? "+" : "") + fmtUsd(acctSummary.unrealized || 0),
                  ),
                ),
                React.createElement("span", { className: "text-[#6b7280]", title: "Profit or loss from positions that have already been sold" }, "Closed P&L ",
                  React.createElement("span", { className: `font-bold tabular-nums ${(acctSummary.totalRealized || 0) >= 0 ? "text-[#00e676]" : "text-red-400"}` },
                    (acctSummary.totalRealized >= 0 ? "+" : "") + fmtUsd(acctSummary.totalRealized || 0),
                  ),
                ),
              ),
            ),
          ),

          // ═══ 3-Panel: Viewport | Action Kanban | Detail (responsive) ═══
          React.createElement("div", { className: "investor-3panel flex flex-col lg:flex-row gap-4 px-4 shrink-0" },
            // Left: Viewport (scrollable ticker list — hidden on mobile)
            React.createElement("div", { className: "hidden lg:flex w-64 flex-shrink-0 flex-col min-h-0" },
              React.createElement("div", { className: "text-[10px] text-[#4b5563] mb-1 px-1 shrink-0" }, `${filteredTickers.length} ticker${filteredTickers.length !== 1 ? "s" : ""}`),
              React.createElement(TickerListViewport, {
                tickers: filteredTickers,
                onSelect: setSelectedTicker,
                selectedTicker,
                savedTickers,
                toggleSavedTicker,
              }),
            ),

            // Center: Action Kanban (horizontally scrollable on mobile)
            React.createElement("div", { className: "flex-1 flex flex-col min-h-[200px] lg:min-h-0 min-w-0" },
              React.createElement(ActionBoardHeader, { actionCount }),
              filteredTickers.length > 0
                ? React.createElement(ActionKanban, { tickers: filteredTickers, onSelect: setSelectedTicker, selectedTicker })
                : React.createElement("div", { className: "card p-8 text-center text-[#6b7280] flex-1" },
                    React.createElement("div", { className: "text-lg mb-2" }, "No investor data yet"),
                    React.createElement("div", { className: "text-sm" }, "Stock scores are calculated every hour while the market is open. Check back soon."),
                  ),
            ),

            // Right: Detail — inline on desktop, hidden on mobile (slide-in overlay below)
            React.createElement("div", { className: "hidden lg:block w-96 flex-shrink-0 overflow-y-auto min-h-0" },
              React.createElement(TickerDeepDive, { ticker: selectedTicker, data: selectedData }),
            ),
          ),

          // ═══ Mobile Right Rail — fixed slide-in overlay (lg: hidden) ═══
          selectedTicker && React.createElement("div", { className: "lg:hidden" },
            // Backdrop
            React.createElement("div", {
              className: "fixed inset-0 bg-black/50 z-40",
              onClick: () => setSelectedTicker(null),
            }),
            // Slide-in panel
            React.createElement("div", {
              className: "fixed right-0 top-0 w-full sm:w-[380px] h-full bg-[#0a0a0f] border-l border-white/[0.06] z-50 slide-in-right shadow-xl overflow-y-auto",
            },
              // Close button
              React.createElement("div", { className: "sticky top-0 z-10 flex items-center justify-between p-3 border-b border-white/[0.06] bg-[#0a0a0f]/95 backdrop-blur-sm" },
                React.createElement("span", { className: "text-xs text-[#6b7280] font-medium" }, selectedTicker),
                React.createElement("button", {
                  onClick: () => setSelectedTicker(null),
                  className: "text-[#6b7280] hover:text-white transition-colors text-lg leading-none w-7 h-7 flex items-center justify-center rounded hover:bg-white/[0.06]",
                }, "\u2715"),
              ),
              React.createElement("div", { className: "p-3" },
                React.createElement(TickerDeepDive, { ticker: selectedTicker, data: selectedData }),
              ),
            ),
          ),

          // ═══ Portfolio Section (always visible below, no excess scrolling) ═══
          portfolio && React.createElement("div", { className: "px-4 py-3 shrink-0" },
            React.createElement(PortfolioSection, { portfolio }),
          ),
        );
      }

      // ─── Render ──────────────────────────────────────────────────────
      const _AuthGate = window.TimedAuthGate;
      const root = ReactDOM.createRoot(document.getElementById("root"));
      root.render(
        _AuthGate
          ? React.createElement(_AuthGate, { apiBase: API_BASE, requiredTier: "pro" },
              (user) => React.createElement(InvestorDashboard, { user })
            )
          : React.createElement(InvestorDashboard)
      );
    </script>
    <script>
      (function() {
        fetch("/timed/daily-brief/badge", { cache: "no-store" })
          .then(function(r) { return r.json(); })
          .then(function(d) {
            if (d && d.badge && d.badge.ts) {
              var seen = Number(localStorage.getItem("tt_brief_seen") || 0);
              if (d.badge.ts > seen) {
                var el = document.getElementById("brief-badge");
                if (el) el.classList.remove("hidden");
              }
            }
          })
          .catch(function() {});
      })();
    </script>
    <footer id="legal-footer" style="position:fixed;bottom:0;left:0;right:0;z-index:9999;background:rgba(10,10,15,0.92);backdrop-filter:blur(6px);border-top:1px solid rgba(255,255,255,0.06);padding:6px 16px;text-align:center;font-size:10px;color:#6b7280;line-height:1.4;">
      For informational and educational purposes only. Not investment advice. Past performance does not guarantee future results. All trading involves risk of loss. <a href="/terms.html" style="color:#6b7280;text-decoration:underline;">Full Terms</a> · Market data powered by <a href="https://twelvedata.com" target="_blank" rel="noopener" style="color:#6b7280;text-decoration:underline;">Twelve Data</a>
    </footer>
  </body>
</html>
